{% extends "base.html" %}
{% load static %}

{% block content %}

<style>
  .settings-container {
    display: flex;
    gap: 25px;
    padding: 0;
    min-height: calc(100vh - 100px);
  }

  .settings-sidebar {
    width: 280px;
    background: linear-gradient(180deg, #ffffff 0%, #f8f9fa 100%);
    border-radius: 15px;
    padding: 25px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.08);
    height: fit-content;
    position: sticky;
    top: 90px;
  }

  .settings-sidebar h3 {
    margin-bottom: 20px;
    font-weight: 700;
    color: #2c3e50;
    font-size: 20px;
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .settings-sidebar h3 i {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    width: 35px;
    height: 35px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 10px;
    font-size: 16px;
  }

  .settings-menu {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .settings-menu li {
    margin-bottom: 8px;
  }

  .settings-menu a {
    text-decoration: none;
    color: #495057;
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px 15px;
    border-radius: 10px;
    transition: all 0.3s ease;
    font-weight: 500;
    font-size: 14px;
  }

  .settings-menu a i {
    width: 20px;
    text-align: center;
    font-size: 16px;
    color: #667eea;
  }

  .settings-menu a:hover {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    transform: translateX(5px);
  }

  .settings-menu a:hover i {
    color: white;
  }

  .settings-menu a.active {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
  }

  .settings-menu a.active i {
    color: white;
  }

  .settings-content {
    flex: 1;
    background: white;
    border-radius: 15px;
    padding: 35px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.05);
  }

  .settings-content h1 {
    font-size: 28px;
    font-weight: 700;
    color: #2c3e50;
    margin-bottom: 10px;
  }

  .settings-content p {
    color: #6c757d;
    font-size: 15px;
  }

  .permission-badge {
    background: #ffc107;
    color: #fff;
    font-size: 10px;
    padding: 2px 6px;
    border-radius: 4px;
    margin-left: auto;
    font-weight: 600;
  }

  .locked-item {
    opacity: 0.5;
    cursor: not-allowed !important;
  }

  .locked-item:hover {
    background: transparent !important;
    transform: none !important;
  }
</style>


<div class="settings-container">

  <!-- ✅ Settings Sidebar with Granular Permission Checks -->
  <aside class="settings-sidebar">
    <h3>
      <i class="fas fa-cog"></i>
      <span>Settings</span>
    </h3>
    
    <ul class="settings-menu">
      
      <!-- Team Management -->
      {% if user_type == 'superuser' or current_user.role == 'admin' or current_user.permissions.can_manage_team_members %}
      <li>
        <a href="{% url 'team_member:team_member_list' %}">
          <i class="fas fa-users"></i>
          <span>Team Management</span>
        </a>
      </li>
      {% endif %}

      <!-- Admin Settings Dashboard -->
      {% if user_type == 'superuser' or current_user.role == 'admin' or current_user.permissions.can_access_admin_settings %}
      <li>
        <a href="{% url 'admin_settings' %}" class="active">
          <i class="fas fa-user-shield"></i>
          <span>Admin Settings</span>
        </a>
      </li>
      {% endif %}

      <!-- Organizational Settings -->
      {% if user_type == 'superuser' or current_user.role == 'admin' or current_user.permissions.can_manage_organization %}
      <li>
        <a href="{% url 'organisational_setting_list' %}">
          <i class="fas fa-building"></i>
          <span>Organization Settings</span>
        </a>
      </li>
      {% endif %}

      <!-- Package Details -->
      {% if user_type == 'superuser' or current_user.role == 'admin' or current_user.permissions.can_view_package_details %}
      <li>
        <a href="{% url 'package_details' %}">
          <i class="fas fa-box"></i>
          <span>Package Details</span>
        </a>
      </li>
      {% endif %}

      <!-- Branch Settings -->
      {% if user_type == 'superuser' or current_user.role == 'admin' or current_user.permissions.can_manage_branches %}
      <li>
        <a href="{% url 'branch_list' %}">
          <i class="fas fa-code-branch"></i>
          <span>Branch Settings</span>
        </a>
      </li>
      {% endif %}

      <!-- Roles -->
      {% if user_type == 'superuser' or current_user.role == 'admin' or current_user.permissions.can_manage_roles %}
      <li>
        <a href="{% url 'role_list' %}">
          <i class="fas fa-user-tag"></i>
          <span>Roles & Permissions</span>
        </a>
      </li>
      {% endif %}

      <!-- Business Settings -->
      {% if user_type == 'superuser' or current_user.role == 'admin' or current_user.permissions.can_manage_business_settings %}
      <li>
        <a href="{% url 'edit_all_settings' %}">
          <i class="fas fa-briefcase"></i>
          <span>Business Settings</span>
        </a>
      </li>
      {% endif %}

      <!-- Divider -->
      <li style="border-top: 1px solid #e9ecef; margin: 15px 0; padding-top: 15px;"></li>

      <!-- Additional Settings -->
      <li>
        <a href="#">
          <i class="fas fa-bell"></i>
          <span>Notifications</span>
        </a>
      </li>

      <li>
        <a href="#">
          <i class="fas fa-shield-alt"></i>
          <span>Security</span>
        </a>
      </li>

      <li>
        <a href="#">
          <i class="fas fa-download"></i>
          <span>Backup & Export</span>
        </a>
      </li>

    </ul>
  </aside>

  <!-- ✅ Main Content with Permission-Based Cards -->
  <div class="settings-content">
    <h1>Admin Settings</h1>
    <p class="mb-4">Manage your TravelHope system settings and configurations.</p>

    <div class="alert alert-info">
      <i class="fas fa-info-circle me-2"></i>
      <strong>Welcome!</strong> Use the sidebar to navigate through different settings sections.
    </div>

    <!-- Settings Cards -->
    <div class="row g-4 mt-3">
      
      <!-- Team Management Card -->
      {% if user_type == 'superuser' or current_user.role == 'admin' or current_user.permissions.can_manage_team_members %}
      <div class="col-md-6">
        <div class="card border-0 shadow-sm h-100">
          <div class="card-body">
            <div class="d-flex align-items-center mb-3">
              <div class="rounded-circle bg-primary bg-opacity-10 p-3 me-3">
                <i class="fas fa-users fa-lg text-primary"></i>
              </div>
              <div>
                <h5 class="card-title mb-0">Team Management</h5>
                <p class="text-muted small mb-0">Manage team members and roles</p>
              </div>
            </div>
            <a href="{% url 'team_member:team_member_list' %}" class="btn btn-outline-primary btn-sm">
              <i class="fas fa-arrow-right me-1"></i>Manage Team
            </a>
          </div>
        </div>
      </div>
      {% endif %}

      <!-- Permissions Card -->
      {% if user_type == 'superuser' or current_user.role == 'admin' %}
      <div class="col-md-6">
        <div class="card border-0 shadow-sm h-100">
          <div class="card-body">
            <div class="d-flex align-items-center mb-3">
              <div class="rounded-circle bg-warning bg-opacity-10 p-3 me-3">
                <i class="fas fa-user-shield fa-lg text-warning"></i>
              </div>
              <div>
                <h5 class="card-title mb-0">Permissions</h5>
                <p class="text-muted small mb-0">Configure user permissions</p>
              </div>
            </div>
            <a href="{% url 'team_member:manage_permissions' %}" class="btn btn-outline-warning btn-sm">
              <i class="fas fa-arrow-right me-1"></i>Manage Permissions
            </a>
          </div>
        </div>
      </div>
      {% endif %}

      <!-- Organization Card -->
      {% if user_type == 'superuser' or current_user.role == 'admin' or current_user.permissions.can_manage_organization %}
      <div class="col-md-6">
        <div class="card border-0 shadow-sm h-100">
          <div class="card-body">
            <div class="d-flex align-items-center mb-3">
              <div class="rounded-circle bg-info bg-opacity-10 p-3 me-3">
                <i class="fas fa-building fa-lg text-info"></i>
              </div>
              <div>
                <h5 class="card-title mb-0">Organization</h5>
                <p class="text-muted small mb-0">Update company details</p>
              </div>
            </div>
            <a href="{% url 'organisational_setting_list' %}" class="btn btn-outline-info btn-sm">
              <i class="fas fa-arrow-right me-1"></i>View Settings
            </a>
          </div>
        </div>
      </div>
      {% endif %}

      <!-- Business Settings Card -->
      {% if user_type == 'superuser' or current_user.role == 'admin' or current_user.permissions.can_manage_business_settings %}
      <div class="col-md-6">
        <div class="card border-0 shadow-sm h-100">
          <div class="card-body">
            <div class="d-flex align-items-center mb-3">
              <div class="rounded-circle bg-success bg-opacity-10 p-3 me-3">
                <i class="fas fa-briefcase fa-lg text-success"></i>
              </div>
              <div>
                <h5 class="card-title mb-0">Business Config</h5>
                <p class="text-muted small mb-0">Configure business rules</p>
              </div>
            </div>
            <a href="{% url 'edit_all_settings' %}" class="btn btn-outline-success btn-sm">
              <i class="fas fa-arrow-right me-1"></i>Configure
            </a>
          </div>
        </div>
      </div>
      {% endif %}

      <!-- Package Details Card -->
      {% if user_type == 'superuser' or current_user.role == 'admin' or current_user.permissions.can_view_package_details %}
      <div class="col-md-6">
        <div class="card border-0 shadow-sm h-100">
          <div class="card-body">
            <div class="d-flex align-items-center mb-3">
              <div class="rounded-circle bg-secondary bg-opacity-10 p-3 me-3">
                <i class="fas fa-box fa-lg text-secondary"></i>
              </div>
              <div>
                <h5 class="card-title mb-0">Package Details</h5>
                <p class="text-muted small mb-0">View and edit packages</p>
              </div>
            </div>
            <a href="{% url 'package_details' %}" class="btn btn-outline-secondary btn-sm">
              <i class="fas fa-arrow-right me-1"></i>View Packages
            </a>
          </div>
        </div>
      </div>
      {% endif %}

      <!-- Branch Settings Card -->
      {% if user_type == 'superuser' or current_user.role == 'admin' or current_user.permissions.can_manage_branches %}
      <div class="col-md-6">
        <div class="card border-0 shadow-sm h-100">
          <div class="card-body">
            <div class="d-flex align-items-center mb-3">
              <div class="rounded-circle bg-dark bg-opacity-10 p-3 me-3">
                <i class="fas fa-code-branch fa-lg text-dark"></i>
              </div>
              <div>
                <h5 class="card-title mb-0">Branch Settings</h5>
                <p class="text-muted small mb-0">Manage branch locations</p>
              </div>
            </div>
            <a href="{% url 'branch_list' %}" class="btn btn-outline-dark btn-sm">
              <i class="fas fa-arrow-right me-1"></i>Manage Branches
            </a>
          </div>
        </div>
      </div>
      {% endif %}

    </div>
  </div>

</div>

{% endblock %}
