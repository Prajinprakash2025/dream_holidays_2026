    {% extends 'package_base.html' %}
    {% load static %}
    {% load booking_tags %}
    {% load widget_tweaks %}
    {% load custom_tags %}

    {% block page_content %}

    <br><br>
    {% if messages %}
    <script>
        {% for message in messages %}
            Swal.fire({
                toast: false,
                position: 'center',
                icon: '{{ message.tags }}',
                title: '{{ message }}',
                showConfirmButton: false,
                timer: 3000
            });
        {% endfor %}
    </script>
    {% endif %}

 <style>
    .section-box {
        background: #ffffff; 
        border: 4px solid #e0e0e0; 
        border-radius: 10px;
        padding: 20px; 
        box-shadow: 0 2px 6px rgba(0,0,0,0.05); 
        height: 100%;
    }
    
    .date-time-section {
        background-color: #fffbeb; 
        border: 1px solid #ffe58f;
        border-radius: 0.375rem; 
        padding: 1.5rem;
    }
    
    .section-box h4 {
        margin-bottom: 20px; 
        font-size: 18px; 
        border-bottom: 2px solid #ddd;
        padding-bottom: 10px;
    }
    
    .list-group .border:hover {
        border-color: #007bff !important; 
        background-color: #f8f9fa;
    }
    
    .accordion-button { 
        background-color: #f8f9fa; 
        border: none; 
    }
    
    .accordion-button:not(.collapsed) { 
        background-color: #e3f2fd; 
        box-shadow: none; 
    }

    /* ==========================================
       BOOKING CARD - BASE STYLES (ALL TYPES)
       ========================================== */
    .booking-card {
        background-color: #fff;
        border: 1px solid #e9ecef;
        border-radius: 8px;
        padding: 1rem;
        margin-bottom: 1rem;
        box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        display: flex;
        align-items: flex-start;
        gap: 1rem;
        transition: all 0.2s ease;
    }

    .booking-card:hover {
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        transform: translateY(-2px);
    }

    /* ==========================================
       BOOKING ICON - DIFFERENT COLORS PER TYPE
       ========================================== */
    .booking-icon {
        flex-shrink: 0;
        width: 60px;
        height: 60px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
        position: relative;
    }

    /* Hotel Icon - Blue */
    .booking-icon.hotel-icon {
        background-color: #e3f2fd;
        color: #007bff;
    }

    /* Vehicle Icon - Purple */
    .booking-icon.vehicle-icon {
        background-color: #f3e5f5;
        color: #9c27b0;
    }

    /* Activity Icon - Green */
    .booking-icon.activity-icon {
        background-color: #e8f5e9;
        color: #4caf50;
    }

    /* Houseboat Icon - Cyan */
    .booking-icon.houseboat-icon {
        background-color: #e0f7fa;
        color: #00bcd4;
    }

    /* Day Itinerary Icon - Gray */
    .booking-icon.itinerary-icon {
        background-color: #e9ecef;
        color: #6c757d;
    }

    .booking-icon .edit-overlay {
        position: absolute;
        bottom: 0;
        right: 0;
        width: 24px;
        height: 24px;
        background-color: #343a40;
        color: #fff;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 12px;
        border: 2px solid #fff;
    }

    /* ==========================================
       BOOKING CONTENT
       ========================================== */
    .booking-content {
        flex-grow: 1;
    }

    .booking-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 0.75rem;
    }

    .hotel-name,
    .vehicle-name,
    .activity-name,
    .houseboat-name {
        font-size: 1.1rem;
        font-weight: 600;
        color: #333;
    }

    .star-rating {
        color: #ffc107;
        margin: 0 0.5rem;
    }

    /* ==========================================
       OPTION BADGES
       ========================================== */
    .option-badge {
        font-size: 0.75rem;
        font-weight: 600;
        padding: 0.25em 0.6em;
        border-radius: 20px;
        color: #fff;
    }

    .option-1 { background-color: #0d6efd; }
    .option-2 { background-color: #198754; }
    .option-3 { background-color: #dc3545; }

    /* ==========================================
       TYPE BADGES (Hotel, Vehicle, etc.)
       ========================================== */
    .type-badge {
        font-size: 0.7rem;
        font-weight: 600;
        padding: 0.3em 0.7em;
        border-radius: 12px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .type-badge.hotel { background-color: #007bff; color: #fff; }
    .type-badge.vehicle { background-color: #9c27b0; color: #fff; }
    .type-badge.activity { background-color: #4caf50; color: #fff; }
    .type-badge.houseboat { background-color: #00bcd4; color: #fff; }

    /* ==========================================
       EDIT/DELETE ICONS
       ========================================== */
    .edit-icon a {
        color: #6c757d;
        font-size: 1.25rem;
        transition: color 0.2s ease;
    }

    .edit-icon a:hover {
        color: #007bff;
    }

    .edit-icon .text-danger:hover {
        color: #dc3545 !important;
    }

    /* ==========================================
       BOOKING DETAILS GRID
       ========================================== */
    .booking-details-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 1rem;
        font-size: 0.9rem;
        padding-top: 0.75rem;
        border-top: 1px solid #f1f1f1;
    }

    .detail-item .label {
        font-size: 0.8rem;
        color: #6c757d;
        text-transform: uppercase;
        font-weight: 500;
        display: block;
        margin-bottom: 0.25rem;
    }

    .detail-item .data {
        font-weight: 500;
        color: #212529;
    }

    .detail-item .data i {
        margin-right: 0.4rem;
        color: #6c757d;
    }

    /* ==========================================
       AVAILABLE ITEMS LIST
       ========================================== */
    .available-items-list .item-card {
        background-color: #f8f9fa;
        border: 1px solid #dee2e6;
        transition: all 0.2s ease;
    }

    .available-items-list .item-card:hover {
        background-color: #e9ecef;
        border-color: #007bff;
        box-shadow: 0 2px 8px rgba(0,123,255,0.1);
    }

    /* ==========================================
       MODAL CUSTOMIZATIONS
       ========================================== */
    .modal-header {
        border-bottom: 2px solid #e9ecef;
    }

    .modal-footer {
        border-top: 2px solid #e9ecef;
    }

    /* Different colored modal headers */
    .modal-header.bg-primary { background-color: #007bff !important; }
    .modal-header.bg-success { background-color: #28a745 !important; }
    .modal-header.bg-info { background-color: #17a2b8 !important; }
    .modal-header.bg-warning { background-color: #ffc107 !important; }

    /* ==========================================
       RESPONSIVE ADJUSTMENTS
       ========================================== */
    @media (max-width: 768px) {
        .booking-card {
            flex-direction: column;
            align-items: flex-start;
        }

        .booking-icon {
            width: 50px;
            height: 50px;
            font-size: 20px;
        }

        .booking-details-grid {
            grid-template-columns: 1fr;
        }

        .hotel-name,
        .vehicle-name,
        .activity-name,
        .houseboat-name {
            font-size: 1rem;
        }
    }

    /* ==========================================
       EMPTY STATE
       ========================================== */
    .empty-state {
        text-align: center;
        padding: 3rem 1rem;
        color: #6c757d;
    }

    .empty-state i {
        font-size: 3rem;
        margin-bottom: 1rem;
        opacity: 0.5;
    }

    /* ==========================================
       LOADING SPINNER
       ========================================== */
    .spinner-border-sm {
        width: 1rem;
        height: 1rem;
        border-width: 0.15em;
    }

    /* ==========================================
       CUSTOM SCROLLBAR (Optional)
       ========================================== */
    .section-box::-webkit-scrollbar {
        width: 6px;
    }

    .section-box::-webkit-scrollbar-track {
        background: #f1f1f1;
        border-radius: 10px;
    }

    .section-box::-webkit-scrollbar-thumb {
        background: #888;
        border-radius: 10px;
    }

    .section-box::-webkit-scrollbar-thumb:hover {
        background: #555;
    }
</style>


<br><br>

<h2 class="mb-4">Plan Days for Package: {{ package.name }}</h2>

<div class="row">
    <!-- LEFT COLUMN: Days & Destinations -->
    <div class="col-lg-3 col-md-4 mb-4">
        <div class="section-box">
            <h4>Days & Destinations</h4>
            {% for day in days %}
                <form method="post" class="mb-3">
                    {% csrf_token %}
                    <input type="hidden" name="form_type" value="destination_select">
                    <input type="hidden" name="day_number" value="{{ day }}">
                    <label for="dest-day-{{ day }}" class="form-label fw-bold">Day {{ day }}:</label>
                    <select name="destination" id="dest-day-{{ day }}" class="form-select" required>
                        <option value="">-- Select Destination --</option>
                        {% for dest in destinations %}
                            <option value="{{ dest.id }}"
                                    {% if plans|get_item:day and plans|get_item:day.destination.id == dest.id %}selected{% endif %}>
                                {{ dest.name }}
                            </option>
                        {% endfor %}
                    </select>
                    <button type="submit" class="btn btn-primary mt-2 w-100">Save</button>
                </form>
            {% endfor %}
        </div>
    </div>

<!-- MIDDLE COLUMN: Saved Items -->
<div class="col-lg-6 mb-4">
    <div class="section-box">
        <h4>Saved Items</h4>
        
        {% if saved_items_by_day %}
            <div class="accordion" id="savedItemsAccordion">
                {% for day_number, day_data in saved_items_by_day.items %}
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="heading{{ day_number }}">
                            <button class="accordion-button {% if not forloop.first %}collapsed{% endif %}" 
                                    type="button" 
                                    data-bs-toggle="collapse" 
                                    data-bs-target="#collapse{{ day_number }}" 
                                    aria-expanded="{% if forloop.first %}true{% else %}false{% endif %}" 
                                    aria-controls="collapse{{ day_number }}">
                                <strong>Day {{ day_number }}</strong>
                                {% if day_data.destination %}
                                    <span class="text-muted ms-2">- {{ day_data.destination }}</span>
                                {% endif %}
                            </button>
                        </h2>
                        
                        <div id="collapse{{ day_number }}" 
                             class="accordion-collapse collapse {% if forloop.first %}show{% endif %}" 
                             aria-labelledby="heading{{ day_number }}" 
                             data-bs-parent="#savedItemsAccordion">
                            <div class="accordion-body">
                            
                                <!-- Day Itinerary Card -->
                                {% if day_data.day_plan %}
                                    {% if day_data.day_plan.title or day_data.day_plan.get_description or day_data.day_plan.get_image %}
                                    <div class="booking-card mb-3" style="border-left: 4px solid #6c757d;">
                                        <div class="booking-icon itinerary-icon">
                                            <i class="fas fa-map-marked-alt"></i>
                                        </div>
                                        <div class="booking-content">
                                            <div class="booking-header">
                                                <div class="d-flex align-items-start w-100">
                                                    {% if day_data.day_plan.get_image %}
                                                    <div class="flex-shrink-0 me-3">
                                                        <img src="{{ day_data.day_plan.get_image.url }}" 
                                                             alt="{{ day_data.day_plan.title }}" 
                                                             style="width: 80px; height: 80px; object-fit: cover; border-radius: 8px;">
                                                    </div>
                                                    {% endif %}
                                                    
                                                    <div class="flex-grow-1">
                                                        {% if day_data.day_plan.title %}
                                                        <span class="hotel-name d-block mb-2">{{ day_data.day_plan.title }}</span>
                                                        {% endif %}
                                                        
                                                        {% if day_data.day_plan.get_description %}
                                                        <p class="text-muted mb-0" style="font-size: 0.9rem; line-height: 1.5;">
                                                            {{ day_data.day_plan.get_description|truncatewords:30 }}
                                                        </p>
                                                        {% endif %}
                                                    </div>
                                                    
                                                    <div class="edit-icon ms-2">
                                                        <a href="#" class="text-primary"
                                                           data-bs-toggle="modal" 
                                                           data-bs-target="#editDayDetailsModal"
                                                           data-day-number="{{ day_number }}"
                                                           data-title="{{ day_data.day_plan.title|default:'' }}"
                                                           data-description="{{ day_data.day_plan.description|default:'' }}"
                                                           title="Edit Day Details">
                                                            <i class="fas fa-pen"></i>
                                                        </a>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    {% endif %}
                                {% endif %}

                                <!-- HOTEL BOOKINGS SECTION -->
                                {% if day_data.hotel_bookings %}
                                    <div class="mb-4">
                                        <h6 class="fw-bold text-primary mb-3">
                                            <i class="fas fa-hotel me-2"></i>Hotel Bookings ({{ day_data.hotel_bookings|length }})
                                        </h6>
                                        {% for booking in day_data.hotel_bookings %}
                                            <div class="booking-card mb-3">
                                                <div class="booking-icon hotel-icon">
                                                    <i class="fas fa-hotel"></i>
                                                    <div class="edit-overlay"><i class="fas fa-pencil-alt"></i></div>
                                                </div>
                                                <div class="booking-content">
                                                    <div class="booking-header">
                                                        <div>
                                                            <span class="hotel-name">{{ booking.hotel.name }}</span>
                                                            <span class="star-rating">{{ booking.category|get_stars }}</span>
                                                            <span class="option-badge option-{{ booking.option|slice:'-1:' }}">
                                                                {{ booking.get_option_display }}
                                                            </span>
                                                        </div>
                                                        <div class="edit-icon d-flex align-items-center">
                                                            <a href="#" 
                                                                class="me-2 text-warning"
                                                                data-bs-toggle="modal"
                                                                data-bs-target="#hotelBookingModal"
                                                                data-booking-id="{{ booking.id }}"
                                                                data-hotel-id="{{ booking.hotel.id }}"
                                                                data-hotel-name="{{ booking.hotel.name }}"
                                                                data-destination-id="{{ booking.destination.id }}"
                                                                data-category="{{ booking.category }}"
                                                                data-room-type-id="{{ booking.room_type.id }}"
                                                                data-meal-plan-id="{{ booking.meal_plan.id }}"
                                                                data-option="{{ booking.option }}"
                                                                data-num-double-beds="{{ booking.num_double_beds }}"
                                                                data-child-with-bed="{{ booking.child_with_bed }}"
                                                                data-child-without-bed="{{ booking.child_without_bed }}"
                                                                data-extra-beds="{{ booking.extra_beds }}"
                                                                data-check-in-date="{{ booking.check_in_date|date:'Y-m-d' }}"
                                                                data-check-in-time="{{ booking.check_in_time|time:'H:i' }}"
                                                                data-check-out-date="{{ booking.check_out_date|date:'Y-m-d' }}"
                                                                data-check-out-time="{{ booking.check_out_time|time:'H:i' }}"
                                                                data-day-number="{{ booking.package_day_plan.day_number }}"
                                                                data-inclusions='{{ booking.get_inclusions_json|safe }}'>
                                                                <i class="fas fa-edit"></i>
                                                                </a>
                                                            
                                                            <form action="{% url 'delete_hotel_booking' booking.id %}" method="post" class="d-inline">
                                                                {% csrf_token %}
                                                                <button type="submit" 
                                                                        class="btn btn-link text-danger p-0" 
                                                                        onclick="return confirm('Are you sure you want to delete this hotel booking?');"
                                                                        title="Delete Booking">
                                                                    <i class="fas fa-trash-alt"></i>
                                                                </button>
                                                            </form>
                                                        </div>
                                                    </div>
                                                    
                                                    <div class="booking-details-grid">
                                                        <div class="detail-item">
                                                            <span class="label">Check-in</span>
                                                            <span class="data">
                                                                <i class="fas fa-calendar-alt"></i> 
                                                                {{ booking.check_in_date|date:"d M Y" }}
                                                            </span>
                                                        </div>
                                                        <div class="detail-item">
                                                            <span class="label">Check-out</span>
                                                            <span class="data">
                                                                <i class="fas fa-calendar-alt"></i> 
                                                                {{ booking.check_out_date|date:"d M Y" }}
                                                            </span>
                                                        </div>
                                                        <div class="detail-item">
                                                            <span class="label">Room Type</span>
                                                            <span class="data">
                                                                <i class="fas fa-building"></i> 
                                                                {% if booking.room_type %}{{ booking.room_type.name }}{% else %}N/A{% endif %}
                                                            </span>
                                                        </div>
                                                        <div class="detail-item">
                                                            <span class="label">Rooms</span>
                                                            <span class="data">
                                                                <i class="fas fa-bed"></i> 
                                                                {{ booking.num_rooms }} room{{ booking.num_rooms|pluralize }}
                                                            </span>
                                                        </div>
                                                        <div class="detail-item">
                                                            <span class="label">Meal Plan</span>
                                                            <span class="data">
                                                                <i class="fas fa-utensils"></i> 
                                                                {% if booking.meal_plan %}{{ booking.meal_plan.name }}{% else %}N/A{% endif %}
                                                            </span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        {% endfor %}
                                    </div>
                                {% endif %}

                                <!-- VEHICLE BOOKINGS SECTION -->
                                {% if day_data.vehicle_bookings %}
                                    <div class="mb-4">
                                        <h6 class="fw-bold mb-3" style="color: #9c27b0;">
                                            <i class="fas fa-car me-2"></i>Vehicle Bookings ({{ day_data.vehicle_bookings|length }})
                                        </h6>
                                        {% for booking in day_data.vehicle_bookings %}
                                            <div class="booking-card mb-3">
                                                <div class="booking-icon vehicle-icon">
                                                    <i class="fas fa-car"></i>
                                                    <div class="edit-overlay"><i class="fas fa-pencil-alt"></i></div>
                                                </div>
                                                <div class="booking-content">
                                                    <div class="booking-header">
                                                        <div>
                                                            <span class="vehicle-name">{{ booking.vehicle.name }}</span>
                                                            <span class="option-badge option-{{ booking.option|slice:'-1:' }}">
                                                                {{ booking.get_option_display }}
                                                            </span>
                                                        </div>
                                                        <div class="edit-icon d-flex align-items-center">
                                                            <a href="#" class="me-2 text-warning"
                                                               data-bs-toggle="modal"
                                                               data-bs-target="#bookVehicleModal"
                                                               data-booking-id="{{ booking.id }}"
                                                               data-vehicle-id="{{ booking.vehicle.id }}"
                                                               data-vehicle-name="{{ booking.vehicle.name }}"
                                                               data-day-number="{{ day_number }}"
                                                               data-destination-id="{{ booking.destination.id }}"
                                                               data-pickup-date="{{ booking.pickup_date|date:'Y-m-d' }}"
                                                               data-pickup-time="{{ booking.pickup_time|time:'H:i' }}"
                                                               data-num-passengers="{{ booking.num_passengers }}"
                                                               data-vehicle-type="{{ booking.vehicle_type }}"
                                                               data-option="{{ booking.option }}"
                                                               data-total-km="{{ booking.total_km }}"
                                                               title="Edit Booking">
                                                                <i class="fas fa-edit"></i>
                                                            </a>
                                                            
                                                            <form action="{% url 'delete_vehicle_booking' booking.id %}" method="post" class="d-inline">
                                                                {% csrf_token %}
                                                                <button type="submit" 
                                                                        class="btn btn-link text-danger p-0" 
                                                                        onclick="return confirm('Are you sure you want to delete this vehicle booking?');"
                                                                        title="Delete Booking">
                                                                    <i class="fas fa-trash-alt"></i>
                                                                </button>
                                                            </form>
                                                        </div>
                                                    </div>
                                                    
                                                    <div class="booking-details-grid">
                                                        <div class="detail-item">
                                                            <span class="label">Pickup Date</span>
                                                            <span class="data">
                                                                <i class="fas fa-calendar-alt"></i> 
                                                                {{ booking.pickup_date|date:"d M Y" }}
                                                            </span>
                                                        </div>
                                                        <div class="detail-item">
                                                            <span class="label">Pickup Time</span>
                                                            <span class="data">
                                                                <i class="fas fa-clock"></i> 
                                                                {{ booking.pickup_time|time:"H:i" }}
                                                            </span>
                                                        </div>
                                                        <div class="detail-item">
                                                            <span class="label">Passengers</span>
                                                            <span class="data">
                                                                <i class="fas fa-users"></i> 
                                                                {{ booking.num_passengers }} passenger{{ booking.num_passengers|pluralize }}
                                                            </span>
                                                        </div>
                                                        <div class="detail-item">
                                                            <span class="label">Vehicle Type</span>
                                                            <span class="data">
                                                                <i class="fas fa-car-side"></i> 
                                                                {{ booking.vehicle_type|default:"N/A" }}
                                                            </span>
                                                        </div>
                                                        <div class="detail-item">
                                                            <span class="label">Total KM</span>
                                                            <span class="data">
                                                                <i class="fas fa-road"></i> 
                                                                {{ booking.total_km }} km
                                                            </span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        {% endfor %}
                                    </div>
                                {% endif %}

                                <!-- ACTIVITY BOOKINGS SECTION -->
                                {% if day_data.activity_bookings %}
                                    <div class="mb-4">
                                        <h6 class="fw-bold mb-3" style="color: #4caf50;">
                                            <i class="fas fa-hiking me-2"></i>Activity Bookings ({{ day_data.activity_bookings|length }})
                                        </h6>
                                        {% for booking in day_data.activity_bookings %}
                                            <div class="booking-card mb-3">
                                                <div class="booking-icon activity-icon">
                                                    <i class="fas fa-hiking"></i>
                                                    <div class="edit-overlay"><i class="fas fa-pencil-alt"></i></div>
                                                </div>
                                                <div class="booking-content">
                                                    <div class="booking-header">
                                                        <div>
                                                            <span class="activity-name">{{ booking.activity.name }}</span>
                                                        </div>
                                                        <div class="edit-icon d-flex align-items-center">
                                                            <a href="#" class="me-2 text-warning"
                                                               data-bs-toggle="modal"
                                                               data-bs-target="#activityBookingModal"
                                                               data-booking-id="{{ booking.id }}"
                                                               data-activity-id="{{ booking.activity.id }}"
                                                               data-activity-name="{{ booking.activity.name }}"
                                                               data-day-number="{{ day_number }}"
                                                               data-booking-date="{{ booking.booking_date|date:'Y-m-d' }}"
                                                               data-booking-time="{{ booking.booking_time|time:'H:i' }}"
                                                               data-num-adults="{{ booking.num_adults }}"
                                                               data-num-children="{{ booking.num_children }}"
                                                               data-notes="{{ booking.notes }}"
                                                               title="Edit Booking">
                                                                <i class="fas fa-edit"></i>
                                                            </a>
                                                            
                                                            <form action="{% url 'delete_activity_booking' booking.id %}" method="post" class="d-inline">
                                                                {% csrf_token %}
                                                                <button type="submit" 
                                                                        class="btn btn-link text-danger p-0" 
                                                                        onclick="return confirm('Are you sure you want to delete this activity booking?');"
                                                                        title="Delete Booking">
                                                                    <i class="fas fa-trash-alt"></i>
                                                                </button>
                                                            </form>
                                                        </div>
                                                    </div>
                                                    
                                                    <div class="booking-details-grid">
                                                        <div class="detail-item">
                                                            <span class="label">Booking Date</span>
                                                            <span class="data">
                                                                <i class="fas fa-calendar-alt"></i> 
                                                                {% if booking.booking_date %}{{ booking.booking_date|date:"d M Y" }}{% else %}N/A{% endif %}
                                                            </span>
                                                        </div>
                                                        <div class="detail-item">
                                                            <span class="label">Booking Time</span>
                                                            <span class="data">
                                                                <i class="fas fa-clock"></i> 
                                                                {% if booking.booking_time %}{{ booking.booking_time|time:"H:i" }}{% else %}N/A{% endif %}
                                                            </span>
                                                        </div>
                                                        <div class="detail-item">
                                                            <span class="label">Adults</span>
                                                            <span class="data">
                                                                <i class="fas fa-user"></i> 
                                                                {{ booking.num_adults }} adult{{ booking.num_adults|pluralize }}
                                                            </span>
                                                        </div>
                                                        <div class="detail-item">
                                                            <span class="label">Children</span>
                                                            <span class="data">
                                                                <i class="fas fa-child"></i> 
                                                                {{ booking.num_children }} child{{ booking.num_children|pluralize:"ren" }}
                                                            </span>
                                                        </div>
                                                        {% if booking.notes %}
                                                        <div class="detail-item" style="grid-column: 1 / -1;">
                                                            <span class="label">Notes</span>
                                                            <span class="data">
                                                                <i class="fas fa-sticky-note"></i> 
                                                                {{ booking.notes }}
                                                            </span>
                                                        </div>
                                                        {% endif %}
                                                    </div>
                                                </div>
                                            </div>
                                        {% endfor %}
                                    </div>
                                {% endif %}

                                <!-- HOUSEBOAT BOOKINGS SECTION -->
                                {% if day_data.houseboat_bookings %}
                                    <div class="mb-4">
                                        <h6 class="fw-bold mb-3" style="color: #00bcd4;">
                                            <i class="fas fa-ship me-2"></i>Houseboat Bookings ({{ day_data.houseboat_bookings|length }})
                                        </h6>
                                        {% for booking in day_data.houseboat_bookings %}
                                            <div class="booking-card mb-3">
                                                <div class="booking-icon houseboat-icon">
                                                    <i class="fas fa-ship"></i>
                                                    <div class="edit-overlay"><i class="fas fa-pencil-alt"></i></div>
                                                </div>
                                                <div class="booking-content">
                                                    <div class="booking-header">
                                                        <div>
                                                            <span class="houseboat-name">{{ booking.houseboat.name }}</span>
                                                        </div>
                                                        <div class="edit-icon d-flex align-items-center">
                                                             <a href="#" class="me-2 text-warning"
                                                                data-bs-toggle="modal"
                                                                data-bs-target="#houseboatBookingModal"
                                                                data-booking-id="{{ booking.id }}"
                                                                data-houseboat-id="{{ booking.houseboat.id }}"
                                                                data-houseboat-name="{{ booking.houseboat.name }}"
                                                                data-day-number="{{ day_number }}"
                                                                data-meal-plan-id="{% if booking.meal_plan %}{{ booking.meal_plan.id }}{% endif %}"
                                                                data-room-type-id="{% if booking.room_type %}{{ booking.room_type.id }}{% endif %}"
                                                                data-check-in-date="{{ booking.check_in_date|date:'Y-m-d' }}"
                                                                data-check-out-date="{{ booking.check_out_date|date:'Y-m-d' }}"
                                                                data-num-one-bed-rooms="{{ booking.num_one_bed_rooms }}"
                                                                data-num-two-bed-rooms="{{ booking.num_two_bed_rooms }}"
                                                                data-num-three-bed-rooms="{{ booking.num_three_bed_rooms }}"
                                                                data-num-four-bed-rooms="{{ booking.num_four_bed_rooms }}"
                                                                data-num-five-bed-rooms="{{ booking.num_five_bed_rooms }}"
                                                                data-num-six-bed-rooms="{{ booking.num_six_bed_rooms }}"
                                                                data-num-seven-bed-rooms="{{ booking.num_seven_bed_rooms }}"
                                                                data-num-eight-bed-rooms="{{ booking.num_eight_bed_rooms }}"
                                                                data-num-nine-bed-rooms="{{ booking.num_nine_bed_rooms }}"
                                                                data-num-ten-bed-rooms="{{ booking.num_ten_bed_rooms }}"
                                                                data-num-extra-beds="{{ booking.num_extra_beds }}"
                                                                data-inclusions='[{% for item in booking.inclusion_items.all %}{"id":{{ item.special_inclusion.id }},"name":"{{ item.special_inclusion.name|escapejs }}","adults":{{ item.num_adults|default:0 }},"children":{{ item.num_children|default:0 }}}{% if not forloop.last %},{% endif %}{% endfor %}]'
                                                                title="Edit Booking">
                                                                    <i class="fas fa-edit"></i>
                                                                </a>
                                                            
                                                            <form action="{% url 'delete_houseboat_booking' booking.id %}" method="post" class="d-inline">
                                                                {% csrf_token %}
                                                                <button type="submit" 
                                                                        class="btn btn-link text-danger p-0" 
                                                                        onclick="return confirm('Are you sure you want to delete this houseboat booking?');"
                                                                        title="Delete Booking">
                                                                    <i class="fas fa-trash-alt"></i>
                                                                </button>
                                                            </form>
                                                        </div>
                                                    </div>
                                                    
                                                    <div class="booking-details-grid">
                                                        <div class="detail-item">
                                                            <span class="label">Check-in</span>
                                                            <span class="data">
                                                                <i class="fas fa-calendar-alt"></i> 
                                                                {{ booking.check_in_date|date:"d M Y" }}
                                                            </span>
                                                        </div>
                                                        <div class="detail-item">
                                                            <span class="label">Check-out</span>
                                                            <span class="data">
                                                                <i class="fas fa-calendar-alt"></i> 
                                                                {{ booking.check_out_date|date:"d M Y" }}
                                                            </span>
                                                        </div>
                                                        <div class="detail-item">
                                                            <span class="label">Meal Plan</span>
                                                            <span class="data">
                                                                <i class="fas fa-utensils"></i> 
                                                                {% if booking.meal_plan %}{{ booking.meal_plan.name }}{% else %}N/A{% endif %}
                                                            </span>
                                                        </div>
                                                        <div class="detail-item">
                                                            <span class="label">Room Type</span>
                                                            <span class="data">
                                                                <i class="fas fa-bed"></i> 
                                                                {% if booking.room_type %}{{ booking.room_type.name }}{% else %}N/A{% endif %}
                                                            </span>
                                                        </div>
                                                        <div class="detail-item">
                                                            <span class="label">Total Rooms</span>
                                                            <span class="data">
                                                                <i class="fas fa-door-open"></i> 
                                                                {% with total_rooms=booking.num_one_bed_rooms|add:booking.num_two_bed_rooms|add:booking.num_three_bed_rooms|add:booking.num_four_bed_rooms|add:booking.num_five_bed_rooms|add:booking.num_six_bed_rooms|add:booking.num_seven_bed_rooms|add:booking.num_eight_bed_rooms|add:booking.num_nine_bed_rooms|add:booking.num_ten_bed_rooms %}
                                                                    {{ total_rooms }} room{{ total_rooms|pluralize }}
                                                                {% endwith %}
                                                            </span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        {% endfor %}
                                    </div>
                                {% endif %}

                                <!-- Empty State for Day -->
                                {% if not day_data.hotel_bookings and not day_data.vehicle_bookings and not day_data.houseboat_bookings and not day_data.activity_bookings %}
                                    <div class="text-center py-3 text-muted">
                                        <i class="fas fa-calendar-times fa-2x mb-2"></i>
                                        <p class="mb-0">No bookings for this day yet.</p>
                                    </div>
                                {% endif %}

                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="text-center py-5">
                <i class="fas fa-inbox fa-3x text-muted mb-3"></i>
                <p class="text-muted mb-0">No saved items yet. Start adding bookings to your package!</p>
            </div>
        {% endif %}
        
    </div>
</div>



<!-- RIGHT COLUMN: Add Items -->
<div class="col-lg-3 mb-4">
    <div class="section-box">
        <h4 class="mb-3">
            <i class="fas fa-plus-circle me-2"></i>Add Items to Day
        </h4>
        
        <!-- Day and Section Selection Form -->
        <form method="post" class="mb-4">
            {% csrf_token %}
            <input type="hidden" name="form_type" value="section_select">
            
            <div class="mb-3">
                <label class="form-label fw-bold">
                    <i class="fas fa-calendar-day me-1"></i>Select Day
                </label>
                <select name="day_number" class="form-select" required>
                    <option value="">-- Select Day --</option>
                    {% for day in days %}
                        <option value="{{ day }}" {% if context_day_number == day %}selected{% endif %}>
                            Day {{ day }}
                        </option>
                    {% endfor %}
                </select>
            </div>
            
            <div class="mb-3">
                <label class="form-label fw-bold">
                    <i class="fas fa-list me-1"></i>Select Section
                </label>
                <select name="section" class="form-select" required>
                    <option value="">-- Choose Section --</option>
                    {% for s in sections %}
                        <option value="{{ s }}" {% if selected_section == s %}selected{% endif %}>
                            {{ s|capfirst }}
                        </option>
                    {% endfor %}
                </select>
            </div>
            
            <button type="submit" class="btn btn-primary w-100">
                <i class="fas fa-search me-2"></i>Load Items
            </button>
        </form>

        <!-- Available Items Display -->
        {% if selected_section and context_day_number %}
            <div class="border-top pt-3">
                <h6 class="fw-bold mb-3">
                    <i class="fas fa-box-open me-2"></i>
                    Available {{ selected_section|capfirst }} for Day {{ context_day_number }}
                </h6>
                
                {% if section_data %}
                    <div class="available-items-list">
                        {% for item in section_data %}
                            <div class="item-card d-flex align-items-center justify-content-between mb-2 p-2 border rounded">
                                <div class="item-info flex-grow-1">
                                    <div class="fw-bold">{{ item.name }}</div>
                                    {% if item.destination %}
                                        <small class="text-muted">
                                            <i class="fas fa-map-marker-alt me-1"></i>
                                            {{ item.destination.name }}
                                        </small>
                                    {% endif %}
                                </div>
                                
                                <div class="item-actions ms-2">
                                    {% with day_plan=plans|get_item:context_day_number %}
                                        
                                        <!-- HOTEL BOOKING BUTTON -->
                                        {% if selected_section == "hotels" %}
                                            <button type="button" 
                                                    class="btn btn-sm btn-primary"
                                                    data-bs-toggle="modal" 
                                                    data-bs-target="#hotelBookingModal"
                                                    data-hotel-id="{{ item.id }}"
                                                    data-hotel-name="{{ item.name }}"
                                                    data-day-number="{{ context_day_number }}"
                                                    data-destination-id="{% if day_plan.destination %}{{ day_plan.destination.id }}{% endif %}"
                                                    title="Book {{ item.name }}">
                                                <i class="fas fa-calendar-check"></i> Book
                                            </button>
                                        {% endif %}
                                        
                                        <!-- VEHICLE BOOKING BUTTON -->
                                        {% if selected_section == "vehicles" %}
                                            <button type="button" 
                                                    class="btn btn-sm btn-primary"
                                                    data-bs-toggle="modal" 
                                                    data-bs-target="#bookVehicleModal"
                                                    data-vehicle-id="{{ item.id }}"
                                                    data-vehicle-name="{{ item.name }}"
                                                    data-day-number="{{ context_day_number }}"
                                                    data-destination-id="{% if day_plan.destination %}{{ day_plan.destination.id }}{% endif %}"
                                                    title="Book {{ item.name }}">
                                                <i class="fas fa-calendar-check"></i> Book
                                            </button>
                                        {% endif %}
                                        
                                        <!-- ACTIVITY BOOKING BUTTON -->
                                        {% if selected_section == "activities" %}
                                            <button type="button" 
                                                    class="btn btn-sm btn-success"
                                                    data-bs-toggle="modal" 
                                                    data-bs-target="#activityBookingModal"
                                                    data-activity-id="{{ item.id }}"
                                                    data-activity-name="{{ item.name }}"
                                                    data-day-number="{{ context_day_number }}"
                                                    title="Book {{ item.name }}">
                                                <i class="fas fa-calendar-check"></i> Book
                                            </button>
                                        {% endif %}
                                        
                                        <!-- HOUSEBOAT BOOKING BUTTON -->
                                        {% if selected_section == "houseboats" %}
                                            <button type="button" 
                                                    class="btn btn-sm btn-info text-white"
                                                    data-bs-toggle="modal" 
                                                    data-bs-target="#houseboatBookingModal"
                                                    data-houseboat-id="{{ item.id }}"
                                                    data-houseboat-name="{{ item.name }}"
                                                    data-day-number="{{ context_day_number }}"
                                                    title="Book {{ item.name }}">
                                                <i class="fas fa-calendar-check"></i> Book
                                            </button>
                                        {% endif %}
                                        
                                    {% endwith %}
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i>
                        No {{ selected_section }} available for booking.
                    </div>
                {% endif %}
            </div>
        {% else %}
            <div class="alert alert-light text-center">
                <i class="fas fa-arrow-up fa-2x mb-2 d-block text-muted"></i>
                <small class="text-muted">Select a day and section above to view available items</small>
            </div>
        {% endif %}
    </div>
</div>
</div> 



<!--  HOTEL BOOKING MODAL - WITH SCROLLABLE BODY AND FIXED FOOTER -->
<div class="modal fade" id="hotelBookingModal" tabindex="-1" aria-labelledby="hotelBookingModalLabel" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog modal-xl modal-dialog-scrollable modal-dialog-centered">
        <div class="modal-content" style="max-height: 90vh;">
            <form method="post" id="hotelBookingForm" action="">
                {% csrf_token %}
                
                <!-- Hidden Fields -->
                <input type="hidden" name="booking_id" id="modalBookingId">
                <input type="hidden" id="packageFromDate" value="{{ package.from_date|date:'Y-m-d'|default:'' }}">
                <input type="hidden" id="packageToDate" value="{{ package.to_date|date:'Y-m-d'|default:'' }}">
                <input type="hidden" id="hotelPackageDefaultAdults" value="{{ package.num_adults|default:2 }}">
                <input type="hidden" id="hotelPackageDefaultChildren" value="{{ package.num_children|default:0 }}">
                <input type="hidden" id="packageDefaultInfants" value="{{ package.default_infants|default:'0' }}">
                <input type="hidden" name="inclusions_data" id="inclusionsData">
                <input type="hidden" name="hotel_id" id="modalHotelId">
                <input type="hidden" name="day_number" id="modalDayNumber">

                <!-- Modal Header -->
                <div class="modal-header bg-primary text-white sticky-top" style="z-index: 1050;">
                    <h5 class="modal-title" id="hotelBookingModalLabel">
                        <i class="fas fa-hotel me-2"></i>Hotel Booking Details
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                
                <!-- Modal Body - Scrollable -->
                <div class="modal-body" style="max-height: calc(90vh - 140px); overflow-y: auto;">
                    
                    <!-- Hotel Name (Read-only) -->
                    <div class="mb-3">
                        <label for="modalHotelName" class="form-label fw-semibold">
                            <i class="fas fa-building me-2 text-primary"></i>Hotel Name
                        </label>
                        <input type="text" class="form-control bg-light" id="modalHotelName" readonly>
                    </div>

                    <!-- Destination Field -->
                    <div class="mb-3">
                        <label for="modalDestination" class="form-label fw-semibold">
                            <i class="fas fa-map-marker-alt me-2 text-danger"></i>Destination *
                        </label>
                        <select class="form-select" id="modalDestination" name="destination" required>
                            <option value="">-- Select Destination --</option>
                            {% for destination in destinations %}
                                <option value="{{ destination.id }}">{{ destination.name }}</option>
                            {% endfor %}
                        </select>
                    </div>

                    <!-- Category and Room Type Row -->
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="hotelCategory" class="form-label fw-semibold">
                                <i class="fas fa-star me-2 text-warning"></i>Category
                            </label>
                            <select class="form-select" id="hotelCategory" name="category">
                                <option value="">-- Select Category --</option>
                                <option value="1 Star">1 Star</option>
                                <option value="2 Star">2 Star</option>
                                <option value="3 Star">3 Star</option>
                                <option value="4 Star">4 Star</option>
                                <option value="5 Star">5 Star</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label for="roomType" class="form-label fw-semibold">
                                <i class="fas fa-door-open me-2 text-info"></i>Room Type
                            </label>
                            <select name="room_type" id="roomType" class="form-select">
                                <option value="">-- Select Room Type --</option>
                                {% for r in room_types %}
                                    <option value="{{ r.id }}">{{ r.name }}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>

                    <!-- Meal Plan and Hotel Option -->
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="mealPlan" class="form-label fw-semibold">
                                <i class="fas fa-utensils me-2 text-success"></i>Meal Plan
                            </label>
                            <select class="form-select" id="mealPlan" name="meal_plan">
                                <option value="">-- Select Meal Plan --</option>
                                {% for plan in meal_plans %}
                                    <option value="{{ plan.id }}">{{ plan.name }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label for="hotelOption" class="form-label fw-semibold">
                                <i class="fas fa-list-alt me-2 text-secondary"></i>Hotel Option
                            </label>
                            <select name="option" id="hotelOption" class="form-select">
                                <option value="option_1">Option 1</option>
                                <option value="option_2">Option 2</option>
                                <option value="option_3">Option 3</option>
                            </select>
                        </div>
                    </div>

                    <!-- Special Inclusions Section -->
                    <div class="border p-3 rounded bg-light mb-4">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h6 class="mb-0 fw-bold">
                                <i class="fas fa-star me-2 text-warning"></i>Special Inclusions (Optional)
                            </h6>
                            <button type="button" class="btn btn-sm btn-primary" id="addInclusionBtn">
                                <i class="fas fa-plus me-1"></i> Add Inclusion
                            </button>
                        </div>
                        
                        <!-- Container for inclusion rows -->
                        <div id="inclusionsContainer">
                            <div class="text-center text-muted py-4" id="noInclusionsMessage">
                                <i class="fas fa-info-circle me-2"></i>
                                No inclusions added yet. Click "Add Inclusion" to add special inclusions.
                            </div>
                        </div>
                        
                        <!-- Total Summary -->
                        <div id="inclusionsSummary" class="mt-3 p-3 bg-white rounded border" style="display: none;">
                            <div class="d-flex justify-content-between align-items-center">
                                <strong class="text-primary">
                                    <i class="fas fa-calculator me-2"></i>Total Inclusions Cost:
                                </strong>
                                <strong id="totalInclusionCost" class="text-success fs-5">0.00</strong>
                            </div>
                            <small class="text-muted d-block mt-2" id="inclusionsSummaryText"></small>
                        </div>
                    </div>

                    <!-- Room Configuration -->
                    <div class="border p-3 rounded bg-light mb-4">
                        <h6 class="mb-3 fw-bold">
                            <i class="fas fa-bed me-2 text-info"></i>Room Configuration
                        </h6>
                        
                        <div class="row g-3 mb-3">
                            <div class="col-md-6">
                                <label for="numDoubleBeds" class="form-label fw-semibold">
                                    Double Beds *
                                    <small class="text-muted fw-normal">(Rooms auto-match)</small>
                                </label>
                                <input 
                                    type="number" 
                                    name="num_double_beds" 
                                    id="numDoubleBeds" 
                                    class="form-control" 
                                    value="0" 
                                    min="0"
                                    required>
                                <small class="text-muted d-block mt-1">Number of rooms with double beds</small>
                            </div>
                            
                            <div class="col-md-6">
                                <label for="extraBeds" class="form-label fw-semibold">Extra Beds</label>
                                <input 
                                    type="number" 
                                    name="extra_beds" 
                                    id="extraBeds" 
                                    class="form-control" 
                                    value="0" 
                                    min="0">
                                <small class="text-muted d-block mt-1">Additional beds needed</small>
                            </div>
                        </div>
                        
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label for="childWithBed" class="form-label fw-semibold">Children with Bed</label>
                                <input 
                                    type="number" 
                                    name="child_with_bed" 
                                    id="childWithBed" 
                                    class="form-control" 
                                    value="0" 
                                    min="0">
                                <small class="text-muted d-block mt-1">Children requiring their own bed</small>
                            </div>
                            
                            <div class="col-md-6">
                                <label for="childWithoutBed" class="form-label fw-semibold">Children without Bed</label>
                                <input 
                                    type="number" 
                                    name="child_without_bed" 
                                    id="childWithoutBed" 
                                    class="form-control" 
                                    value="0" 
                                    min="0">
                                <small class="text-muted d-block mt-1">Children sharing parent's bed</small>
                            </div>
                        </div>
                    </div>

                    <!-- Check-in/Check-out Section -->
                    <div class="border p-3 rounded bg-light mb-3">
                        <h6 class="mb-3 fw-bold">
                            <i class="fas fa-calendar-check me-2 text-success"></i>Check-in & Check-out Details
                        </h6>
                        
                        {% if package.from_date and package.to_date %}
                        <div class="alert alert-info py-2 mb-3">
                            <small>
                                <i class="fas fa-info-circle me-1"></i>
                                <strong>Package Date Range:</strong> {{ package.from_date|date:"d M Y" }} to {{ package.to_date|date:"d M Y" }}
                            </small>
                        </div>
                        {% endif %}
                        
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="checkinDate" class="form-label fw-semibold">Check-in Date *</label>
                                <input 
                                    type="date" 
                                    name="check_in_date" 
                                    class="form-control" 
                                    id="checkinDate"
                                    {% if package.from_date %}min="{{ package.from_date|date:'Y-m-d' }}"{% endif %}
                                    {% if package.to_date %}max="{{ package.to_date|date:'Y-m-d' }}"{% endif %}
                                    required>
                            </div>
                            <div class="col-md-6">
                                <label for="checkinTime" class="form-label fw-semibold">Check-in Time *</label>
                                <input type="time" name="check_in_time" class="form-control" id="checkinTime" value="14:00" required>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <label for="checkoutDate" class="form-label fw-semibold">Check-out Date *</label>
                                <input 
                                    type="date" 
                                    name="check_out_date" 
                                    class="form-control" 
                                    id="checkoutDate"
                                    {% if package.from_date %}min="{{ package.from_date|date:'Y-m-d' }}"{% endif %}
                                    {% if package.to_date %}max="{{ package.to_date|date:'Y-m-d' }}"{% endif %}
                                    required>
                            </div>
                            <div class="col-md-6">
                                <label for="checkoutTime" class="form-label fw-semibold">Check-out Time *</label>
                                <input type="time" name="check_out_time" class="form-control" id="checkoutTime" value="11:00" required>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Modal Footer - Fixed at Bottom -->
                <div class="modal-footer sticky-bottom bg-white border-top" style="z-index: 1050;">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="fas fa-times me-2"></i>Close
                    </button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save me-2"></i>Save Booking
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>




    <!-- Edit Day Details Modal -->
    <div class="modal fade" id="editDayDetailsModal" tabindex="-1" aria-labelledby="editDayDetailsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <form method="post" enctype="multipart/form-data">
                    {% csrf_token %}
                    <input type="hidden" name="form_type" value="edit_day_details">
                    <input type="hidden" name="day_number" id="editDayNumber">
                    
                    <div class="modal-header bg-primary text-white">
                        <h5 class="modal-title" id="editDayDetailsModalLabel">
                            <i class="fas fa-edit me-2"></i>Edit Day Details
                        </h5>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    
                    <div class="modal-body">
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle me-2"></i>
                            <strong>Tip:</strong> Leave description and image fields empty to use destination defaults
                        </div>
                        
                        <div class="mb-3">
                            <label for="dayTitle" class="form-label">
                                <i class="fas fa-heading me-1"></i>Day Title
                            </label>
                            <input type="text" 
                                class="form-control" 
                                id="dayTitle" 
                                name="title" 
                                placeholder="e.g., Cochin to Cochin (100 KM)">
                            <small class="text-muted">Route or main activity for this day</small>
                        </div>
                        
                        <div class="mb-3">
                            <label for="dayDescription" class="form-label">
                                <i class="fas fa-align-left me-1"></i>Description (Optional)
                            </label>
                            <textarea class="form-control" 
                                    id="dayDescription" 
                                    name="description" 
                                    rows="6"
                                    placeholder="Leave empty to use destination's default description..."></textarea>
                            <small class="text-muted">Custom description for this specific day</small>
                        </div>
                        
                        <div class="mb-3">
                            <label for="dayImage" class="form-label">
                                <i class="fas fa-image me-1"></i>Custom Image (Optional)
                            </label>
                            <input type="file" 
                                class="form-control" 
                                id="dayImage" 
                                name="image" 
                                accept="image/*">
                            <small class="text-muted">Upload only if you want a different image than destination default</small>
                        </div>
                    </div>
                    
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                            <i class="fas fa-times me-1"></i>Cancel
                        </button>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save me-1"></i>Save Details
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>


    <!-- ==========================================
     VEHICLE BOOKING MODAL
     ========================================== -->
<!-- VEHICLE BOOKING MODAL -->
<div class="modal fade" id="bookVehicleModal" tabindex="-1" aria-labelledby="vehicleBookingModalLabel" aria-hidden="true"
     data-url-edit-prototype="{% url 'update_vehicle_booking' 9999 %}">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <form method="post" id="vehicleBookingForm" action="{% url 'create_vehicle_booking_for_package' package.id %}">
                {% csrf_token %}
                
                <!-- Hidden fields -->
                <input type="hidden" name="vehicle_id" value="">
                <input type="hidden" name="day_number" value="">
                <input type="hidden" name="destination_id" value="">
                <input type="hidden" id="vehiclePackageFromDate" value="{{ package.from_date|date:'Y-m-d'|default:'' }}">
                <input type="hidden" id="vehiclePackageToDate" value="{{ package.to_date|date:'Y-m-d'|default:'' }}">
                
                <!--  Hidden fields for package passenger data -->
                <input type="hidden" id="vehiclePackageDefaultAdults" value="{{ package.default_adults|default:2 }}">
                <input type="hidden" id="vehiclePackageDefaultChildren" value="{{ package.default_children|default:0 }}">
                <input type="hidden" id="vehiclePackageDefaultInfants" value="{{ package.default_infants|default:0 }}">

                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title" id="vehicleBookingModalLabel">
                        <i class="fas fa-car me-2"></i>Book Vehicle
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                
                <div class="modal-body">
                    <!-- Vehicle Name Display -->
                    <div class="alert alert-info">
                        <strong>Vehicle:</strong> <span id="modalVehicleName">N/A</span>
                    </div>
                    
                    <!-- Show package date range -->
                    {% if package.from_date and package.to_date %}
                    <div class="alert alert-info py-2 mb-3">
                        <small>
                            <i class="fas fa-info-circle me-1"></i>
                            <strong>Package Date Range:</strong> {{ package.from_date|date:"d M Y" }} to {{ package.to_date|date:"d M Y" }}
                        </small>
                    </div>
                    {% endif %}
                    
                    <!-- Pickup Date & Time -->
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="vehiclePickupDate" class="form-label">
                                <i class="fas fa-calendar-alt me-1"></i>Pickup Date*
                            </label>
                            <input 
                                type="date" 
                                name="pickup_date" 
                                class="form-control" 
                                id="vehiclePickupDate"
                                {% if package.from_date %}min="{{ package.from_date|date:'Y-m-d' }}"{% endif %}
                                {% if package.to_date %}max="{{ package.to_date|date:'Y-m-d' }}"{% endif %}
                                required>
                            <div class="invalid-feedback">
                                Please select a pickup date within the package date range
                            </div>
                        </div>
                        <div class="col-md-6">
                            <label for="vehiclePickupTime" class="form-label">
                                <i class="fas fa-clock me-1"></i>Pickup Time*
                            </label>
                            <input type="time" name="pickup_time" class="form-control" id="vehiclePickupTime" value="09:00" required>
                        </div>
                    </div>
                    
                    <!--  Passenger Breakdown -->
                    <div class="border p-3 rounded bg-light mb-3">
                        <h6 class="mb-3">
                            <i class="fas fa-users me-2"></i>Passenger Details
                            <small class="text-muted ms-2">(From Package: {{ package.total_passengers }} total)</small>
                        </h6>
                        <div class="row g-3">
                            <div class="col-md-4">
                                <label for="vehicleNumAdults" class="form-label">Adults*</label>
                                <input type="number" name="num_adults" class="form-control passenger-count" id="vehicleNumAdults" min="0" value="{{ package.default_adults|default:2 }}" required>
                            </div>
                            <div class="col-md-4">
                                <label for="vehicleNumChildren" class="form-label">Children</label>
                                <input type="number" name="num_children" class="form-control passenger-count" id="vehicleNumChildren" min="0" value="{{ package.default_children|default:0 }}">
                            </div>
                            <div class="col-md-4">
                                <label for="vehicleNumInfants" class="form-label">Infants</label>
                                <input type="number" name="num_infants" class="form-control passenger-count" id="vehicleNumInfants" min="0" value="{{ package.default_infants|default:0 }}">
                            </div>
                        </div>
                    </div>
                    
                    <!--  Total Passengers (Read-only, Auto-calculated) -->
                    <div class="mb-3">
                        <label for="vehicleNumPassengers" class="form-label">
                            <i class="fas fa-users me-1"></i>Total Number of Passengers*
                        </label>
                        <input type="number" name="num_passengers" class="form-control bg-secondary text-white" id="vehicleNumPassengers" min="1" value="{{ package.total_passengers|default:2 }}" readonly required>
                        <small class="text-muted">
                            <i class="fas fa-calculator me-1"></i>Auto-calculated: Adults + Children + Infants
                        </small>
                    </div>
                    
                    <!-- Vehicle Type -->
                    <div class="mb-3">
                        <label for="vehicleType" class="form-label">
                            <i class="fas fa-car-side me-1"></i>Vehicle Type
                        </label>
                        <input type="text" name="vehicle_type" class="form-control" id="vehicleType" placeholder="e.g., SUV, Sedan, Van">
                    </div>
                    
                    <!-- Total KM -->
                    <div class="mb-3">
                        <label for="vehicleTotalKm" class="form-label">
                            <i class="fas fa-road me-1"></i>Total KM
                        </label>
                        <input type="number" name="total_km" class="form-control" id="vehicleTotalKm" min="0" value="0">
                    </div>
                    
                    <!-- Option -->
                    <div class="mb-3">
                        <label for="vehicleOption" class="form-label">
                            <i class="fas fa-list-alt me-1"></i>Option
                        </label>
                        <select name="option" class="form-select" id="vehicleOption">
                            <option value="option_1">Option 1</option>
                            <option value="option_2">Option 2</option>
                            <option value="option_3">Option 3</option>
                        </select>
                    </div>
                </div>
                
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="fas fa-times me-1"></i>Cancel
                    </button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save me-1"></i>Save Booking
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>




<!-- ACTIVITY BOOKING MODAL -->
<div class="modal fade" id="activityBookingModal" tabindex="-1" aria-labelledby="activityBookingModalLabel" aria-hidden="true"
     data-url-edit-prototype="{% url 'update_activity_booking' 9999 %}">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <form method="post" action="{% url 'create_activity_booking_for_package' package.id %}">
                {% csrf_token %}
                
                <!-- Hidden fields -->
                <input type="hidden" name="day_number" value="">
                <input type="hidden" name="activity_id" value="">
                
                <!--  Hidden fields for package data -->
                <input type="hidden" id="activityPackageFromDate" value="{{ package.from_date|date:'Y-m-d'|default:'' }}">
                <input type="hidden" id="activityPackageToDate" value="{{ package.to_date|date:'Y-m-d'|default:'' }}">
                <input type="hidden" id="activityPackageDefaultAdults" value="{{ package.default_adults|default:2 }}">
                <input type="hidden" id="activityPackageDefaultChildren" value="{{ package.default_children|default:0 }}">
                <input type="hidden" id="activityPackageDefaultInfants" value="{{ package.default_infants|default:0 }}">
                
                <div class="modal-header bg-success text-white">
                    <h5 class="modal-title" id="activityBookingModalLabel">
                        <i class="fas fa-hiking me-2"></i>Book Activity
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                
                <div class="modal-body">
                    <!-- Activity Name Display -->
                    <div class="alert alert-success">
                        <strong>Activity:</strong> <span id="modalActivityName">N/A</span>
                    </div>
                    
                    <!--  Show package date range -->
                    {% if package.from_date and package.to_date %}
                    <div class="alert alert-info py-2 mb-3">
                        <small>
                            <i class="fas fa-info-circle me-1"></i>
                            <strong>Package Date Range:</strong> {{ package.from_date|date:"d M Y" }} to {{ package.to_date|date:"d M Y" }}
                        </small>
                    </div>
                    {% endif %}
                    
                    <!-- Booking Date & Time -->
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="activityBookingDate" class="form-label">
                                <i class="fas fa-calendar-alt me-1"></i>Booking Date*
                            </label>
                            <input 
                                type="date" 
                                name="booking_date" 
                                class="form-control" 
                                id="activityBookingDate"
                                {% if package.from_date %}min="{{ package.from_date|date:'Y-m-d' }}"{% endif %}
                                {% if package.to_date %}max="{{ package.to_date|date:'Y-m-d' }}"{% endif %}
                                required>
                            <div class="invalid-feedback">
                                Please select a date within the package date range
                            </div>
                        </div>
                        <div class="col-md-6">
                            <label for="activityBookingTime" class="form-label">
                                <i class="fas fa-clock me-1"></i>Booking Time*
                            </label>
                            <input type="time" name="booking_time" class="form-control" id="activityBookingTime" value="10:00" required>
                        </div>
                    </div>
                    
                    <!--  Passenger Breakdown -->
                    <div class="border p-3 rounded bg-light mb-3">
                        <h6 class="mb-3">
                            <i class="fas fa-users me-2"></i>Participant Details
                            <small class="text-muted ms-2">(From Package: {{ package.total_passengers }} total)</small>
                        </h6>
                        <div class="row g-3">
                            <div class="col-md-4">
                                <label for="activityNumAdults" class="form-label">Adults*</label>
                                <input 
                                    type="number" 
                                    name="num_adults" 
                                    class="form-control activity-participant-count" 
                                    id="activityNumAdults" 
                                    min="0" 
                                    value="{{ package.default_adults|default:1 }}" 
                                    required>
                            </div>
                            <div class="col-md-4">
                                <label for="activityNumChildren" class="form-label">Children</label>
                                <input 
                                    type="number" 
                                    name="num_children" 
                                    class="form-control activity-participant-count" 
                                    id="activityNumChildren" 
                                    min="0" 
                                    value="{{ package.default_children|default:0 }}">
                            </div>
                            <div class="col-md-4">
                                <label for="activityNumInfants" class="form-label">Infants</label>
                                <input 
                                    type="number" 
                                    name="num_infants" 
                                    class="form-control activity-participant-count" 
                                    id="activityNumInfants" 
                                    min="0" 
                                    value="{{ package.default_infants|default:0 }}">
                            </div>
                        </div>
                    </div>
                    
                    <!--  Total Participants (Read-only, Auto-calculated) -->
                    <div class="mb-3">
                        <label for="activityTotalParticipants" class="form-label">
                            <i class="fas fa-users me-1"></i>Total Participants*
                        </label>
                        <input 
                            type="number" 
                            name="total_participants" 
                            class="form-control bg-secondary text-white" 
                            id="activityTotalParticipants" 
                            min="1" 
                            value="{{ package.total_passengers|default:1 }}" 
                            readonly 
                            required>
                        <small class="text-muted">
                            <i class="fas fa-calculator me-1"></i>Auto-calculated: Adults + Children + Infants
                        </small>
                    </div>
                    
                    <!-- Notes -->
                    <div class="mb-3">
                        <label for="activityNotes" class="form-label">
                            <i class="fas fa-sticky-note me-1"></i>Notes
                        </label>
                        <textarea name="notes" class="form-control" id="activityNotes" rows="3" placeholder="Any special requirements or notes..."></textarea>
                    </div>
                </div>
                
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="fas fa-times me-1"></i>Cancel
                    </button>
                    <button type="submit" class="btn btn-success">
                        <i class="fas fa-save me-1"></i>Save Booking
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>




<!-- ==========================================
     HOUSEBOAT BOOKING MODAL
     ========================================== -->
<!--  PACKAGE HOUSEBOAT BOOKING MODAL - WITH MULTI-INCLUSIONS -->
<div class="modal fade" id="houseboatBookingModal" tabindex="-1" aria-hidden="true"
     data-url-edit-prototype="{% url 'update_houseboat_booking' 9999 %}"
     data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog modal-xl modal-dialog-scrollable modal-dialog-centered">
        <div class="modal-content" style="max-height: 90vh;">
            <form method="POST" action="{% url 'create_houseboat_booking_for_package' package.id %}" id="houseboatBookingForm">
                {% csrf_token %}
                
                <!-- Hidden Fields -->
                <input type="hidden" name="houseboat_id" id="modalHouseboatId">
                <input type="hidden" name="day_number" id="houseboatModalDayNumber">
                <input type="hidden" name="inclusions_data" id="houseboatInclusionsData">
                
                <!--  UNIQUE IDs for Houseboat Modal -->
                <input type="hidden" id="houseboatPackageDefaultAdults" value="{{ package.num_adults|default:2 }}">
                <input type="hidden" id="houseboatPackageDefaultChildren" value="{{ package.num_children|default:0 }}">
                
                <!-- Modal Header -->
                <div class="modal-header bg-info text-white">
                    <h5 class="modal-title" id="houseboatBookingModalLabel">
                        <i class="fas fa-ship me-2"></i>Book Houseboat
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                
                <!-- Modal Body - Scrollable -->
                <div class="modal-body" style="max-height: calc(90vh - 140px); overflow-y: auto;">
                    
                    <!-- Houseboat Name Display -->
                    <div class="alert alert-info">
                        <strong><i class="fas fa-ship me-1"></i>Houseboat:</strong> 
                        <span id="modalHouseboatName" class="fw-bold">N/A</span>
                    </div>
                    
                    <!-- Package Date Range Info -->
                    {% if package.from_date and package.to_date %}
                    <div class="alert alert-warning py-2 mb-3">
                        <small>
                            <i class="fas fa-calendar-alt me-1"></i>
                            <strong>Package Date Range:</strong> 
                            {{ package.from_date|date:"d M Y" }} to {{ package.to_date|date:"d M Y" }}
                            <br>
                            <span class="text-muted">
                                <i class="fas fa-info-circle me-1"></i>
                                All dates must be within this range
                            </span>
                        </small>
                    </div>
                    {% endif %}
                    
                    <!-- 1. Check-in & Check-out Dates -->
                    <div class="card mb-3">
                        <div class="card-header bg-light">
                            <h6 class="mb-0">
                                <i class="fas fa-calendar-check me-2 text-primary"></i>
                                Booking Dates
                            </h6>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <label for="houseboatCheckIn" class="form-label fw-semibold">
                                        <i class="fas fa-sign-in-alt me-1 text-success"></i>
                                        Check-in Date *
                                    </label>
                                    <input 
                                        type="date" 
                                        name="check_in_date" 
                                        class="form-control" 
                                        id="houseboatCheckIn"
                                        {% if package.from_date %}min="{{ package.from_date|date:'Y-m-d' }}"{% endif %}
                                        {% if package.to_date %}max="{{ package.to_date|date:'Y-m-d' }}"{% endif %}
                                        required>
                                    <div class="invalid-feedback">
                                        Check-in date must be within package date range
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <label for="houseboatCheckOut" class="form-label fw-semibold">
                                        <i class="fas fa-sign-out-alt me-1 text-danger"></i>
                                        Check-out Date *
                                    </label>
                                    <input 
                                        type="date" 
                                        name="check_out_date" 
                                        class="form-control" 
                                        id="houseboatCheckOut"
                                        {% if package.from_date %}min="{{ package.from_date|date:'Y-m-d' }}"{% endif %}
                                        {% if package.to_date %}max="{{ package.to_date|date:'Y-m-d' }}"{% endif %}
                                        required>
                                    <div class="invalid-feedback">
                                        Check-out date must be within package date range and after check-in
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 2. Meal Plan & Room Type (Dynamically loaded) -->
                    <div class="card mb-3">
                        <div class="card-header bg-light">
                            <h6 class="mb-0">
                                <i class="fas fa-concierge-bell me-2 text-primary"></i>
                                Accommodation Details
                            </h6>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <label class="form-label fw-semibold">
                                        <i class="fas fa-utensils me-1 text-warning"></i>
                                        Meal Plan *
                                    </label>
                                    <select name="meal_plan" class="form-select" required>
                                        <option value="">-- Select Meal Plan --</option>
                                        <!--  Options will be dynamically loaded by JavaScript -->
                                    </select>
                                    <small class="form-text text-muted">
                                        <i class="fas fa-info-circle me-1"></i>
                                        Options filtered based on selected dates and availability
                                    </small>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label fw-semibold">
                                        <i class="fas fa-bed me-1 text-info"></i>
                                        Room Type *
                                    </label>
                                    <select name="room_type" class="form-select" required>
                                        <option value="">-- Select Room Type --</option>
                                        <!--  Options will be dynamically loaded by JavaScript -->
                                    </select>
                                    <small class="form-text text-muted">
                                        <i class="fas fa-info-circle me-1"></i>
                                        Options filtered based on selected dates and availability
                                    </small>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 3.  Special Inclusions (Multi) with Enhanced UI -->
                    <div class="card mb-3 border-warning">
                        <div class="card-header bg-warning bg-opacity-10">
                            <div class="d-flex justify-content-between align-items-center">
                                <h6 class="mb-0">
                                    <i class="fas fa-gift me-2 text-warning"></i>
                                    Special Inclusions (Optional)
                                </h6>
                                <button type="button" class="btn btn-sm btn-warning" id="addHouseboatInclusionBtn">
                                    <i class="fas fa-plus me-1"></i> Add Inclusion
                                </button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="alert alert-info py-2 mb-3">
                                <small>
                                    <i class="fas fa-lightbulb me-1"></i>
                                    <strong>Examples:</strong> Welcome drinks, early check-in, sunset cruise, special decorations, etc.
                                </small>
                            </div>
                            
                            <!-- Container for inclusion rows -->
                            <div id="houseboatInclusionsContainer">
                                <div class="text-center text-muted py-4 border rounded bg-light" id="houseboatNoInclusionsMessage">
                                    <i class="fas fa-info-circle me-2"></i>
                                    No inclusions added yet. Click "Add Inclusion" above to add special services.
                                </div>
                            </div>
                            
                            <!--  Total Summary with better styling -->
                            <div id="houseboatInclusionsSummary" class="mt-3 p-3 bg-success bg-opacity-10 rounded border border-success" style="display: none;">
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <strong class="text-success">
                                        <i class="fas fa-calculator me-2"></i>
                                        Total Inclusions Cost:
                                    </strong>
                                    <strong id="houseboatTotalInclusionCost" class="text-success fs-4">0.00</strong>
                                </div>
                                <hr class="my-2">
                                <small class="text-muted d-block">
                                    <i class="fas fa-receipt me-1"></i>
                                    <strong>Breakdown:</strong> 
                                    <span id="houseboatInclusionsSummaryText"></span>
                                </small>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 4. Room Configuration with better UI -->
                    <div class="card mb-3">
                        <div class="card-header bg-light">
                            <h6 class="mb-0">
                                <i class="fas fa-door-open me-2 text-primary"></i>
                                Room Configuration
                            </h6>
                        </div>
                        <div class="card-body">
                            <div class="alert alert-info py-2 mb-3">
                                <small>
                                    <i class="fas fa-info-circle me-1"></i>
                                    Specify the number of rooms required for each bed configuration
                                </small>
                            </div>
                            <div class="row g-3">
                                <div class="col-md-3">
                                    <label class="form-label">
                                        <i class="fas fa-bed me-1"></i>1-Bed Rooms
                                    </label>
                                    <input type="number" name="num_one_bed_rooms" class="form-control houseboat-room-input" value="0" min="0">
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label">
                                        <i class="fas fa-bed me-1"></i>2-Bed Rooms
                                    </label>
                                    <input type="number" name="num_two_bed_rooms" class="form-control houseboat-room-input" value="0" min="0">
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label">
                                        <i class="fas fa-bed me-1"></i>3-Bed Rooms
                                    </label>
                                    <input type="number" name="num_three_bed_rooms" class="form-control houseboat-room-input" value="0" min="0">
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label">
                                        <i class="fas fa-bed me-1"></i>4-Bed Rooms
                                    </label>
                                    <input type="number" name="num_four_bed_rooms" class="form-control houseboat-room-input" value="0" min="0">
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label">
                                        <i class="fas fa-bed me-1"></i>5-Bed Rooms
                                    </label>
                                    <input type="number" name="num_five_bed_rooms" class="form-control houseboat-room-input" value="0" min="0">
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label">
                                        <i class="fas fa-bed me-1"></i>6-Bed Rooms
                                    </label>
                                    <input type="number" name="num_six_bed_rooms" class="form-control houseboat-room-input" value="0" min="0">
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label">
                                        <i class="fas fa-bed me-1"></i>7-Bed Rooms
                                    </label>
                                    <input type="number" name="num_seven_bed_rooms" class="form-control houseboat-room-input" value="0" min="0">
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label">
                                        <i class="fas fa-bed me-1"></i>8-Bed Rooms
                                    </label>
                                    <input type="number" name="num_eight_bed_rooms" class="form-control houseboat-room-input" value="0" min="0">
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label">
                                        <i class="fas fa-bed me-1"></i>9-Bed Rooms
                                    </label>
                                    <input type="number" name="num_nine_bed_rooms" class="form-control houseboat-room-input" value="0" min="0">
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label">
                                        <i class="fas fa-bed me-1"></i>10-Bed Rooms
                                    </label>
                                    <input type="number" name="num_ten_bed_rooms" class="form-control houseboat-room-input" value="0" min="0">
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label">
                                        <i class="fas fa-plus-circle me-1 text-warning"></i>Extra Beds
                                    </label>
                                    <input type="number" name="num_extra_beds" class="form-control" value="0" min="0">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Modal Footer - Fixed at bottom -->
                <div class="modal-footer sticky-bottom bg-white border-top shadow-sm" style="z-index: 1050;">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="fas fa-times me-1"></i>Cancel
                    </button>
                    <button type="submit" class="btn btn-info text-white">
                        <i class="fas fa-save me-1"></i>Save Booking
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>



<script>

    //  AUTO-CALCULATE TOTAL PASSENGERS (VEHICLE)
    // ==========================================
    // ==========================================
    //  AUTO-CALCULATE TOTAL PASSENGERS (VEHICLE)
    // ==========================================
    function calculateTotalPassengers() {
        const adultsInput = document.getElementById('vehicleNumAdults');
        const childrenInput = document.getElementById('vehicleNumChildren');
        const infantsInput = document.getElementById('vehicleNumInfants');
        const totalInput = document.getElementById('vehicleNumPassengers');
        
        if (!adultsInput || !childrenInput || !infantsInput || !totalInput) {
            console.warn(' Passenger input fields not found');
            return;
        }
        
        const adults = parseInt(adultsInput.value) || 0;
        const children = parseInt(childrenInput.value) || 0;
        const infants = parseInt(infantsInput.value) || 0;
        
        const total = adults + children + infants;
        totalInput.value = total;
        
        if (total > 0) {
            totalInput.classList.remove('is-invalid');
            totalInput.classList.add('is-valid');
        } else {
            totalInput.classList.remove('is-valid');
            totalInput.classList.add('is-invalid');
        }
        
        console.log(` Passenger Calculation: ${adults} adults + ${children} children + ${infants} infants = ${total} total`);
    }

    // ==========================================
    //  AUTO-CALCULATE TOTAL PARTICIPANTS (ACTIVITY)
    // ==========================================
    function calculateTotalActivityParticipants() {
        const adultsInput = document.getElementById('activityNumAdults');
        const childrenInput = document.getElementById('activityNumChildren');
        const infantsInput = document.getElementById('activityNumInfants');
        const totalInput = document.getElementById('activityTotalParticipants');
        
        if (!adultsInput || !childrenInput || !infantsInput || !totalInput) {
            console.warn(' Activity participant input fields not found');
            return;
        }
        
        const adults = parseInt(adultsInput.value) || 0;
        const children = parseInt(childrenInput.value) || 0;
        const infants = parseInt(infantsInput.value) || 0;
        
        const total = adults + children + infants;
        totalInput.value = total;
        
        if (total > 0) {
            totalInput.classList.remove('is-invalid');
            totalInput.classList.add('is-valid');
        } else {
            totalInput.classList.remove('is-valid');
            totalInput.classList.add('is-invalid');
        }
        
        console.log(` Activity Participants: ${adults} adults + ${children} children + ${infants} infants = ${total} total`);
    }

    // ==========================================
    //  LOAD VALID HOUSEBOAT OPTIONS FOR PACKAGE
    // ==========================================
    function loadValidHouseboatOptionsForPackage(houseboatId, checkInDate, checkOutDate) {
        if (!houseboatId || !checkInDate || !checkOutDate) {
            console.log(' Missing parameters for package houseboat options');
            return;
        }
        
        console.log(` [PACKAGE] Loading options for houseboat ${houseboatId} (${checkInDate} to ${checkOutDate})`);
        
        fetch(`/houseboat/${houseboatId}/valid-options/?check_in=${checkInDate}&check_out=${checkOutDate}`)
            .then(response => response.json())
            .then(data => {
                console.log(' [PACKAGE] API Response:', data);
                
                if (data.success) {
                    console.log(` [PACKAGE] Found ${data.room_type_count} room types and ${data.meal_plan_count} meal plans`);
                    
                    //  UPDATE ROOM TYPE DROPDOWN
                    const roomTypeSelect = document.querySelector('#houseboatBookingModal [name="room_type"]');
                    console.log('[PACKAGE] Room type select element:', roomTypeSelect);
                    
                    if (roomTypeSelect) {
                        // COMPLETELY REMOVE ALL OPTIONS
                        while (roomTypeSelect.options.length > 0) {
                            roomTypeSelect.remove(0);
                        }
                        console.log(' [PACKAGE] Cleared all room type options');
                        
                        // Add placeholder
                        const placeholderOption = document.createElement('option');
                        placeholderOption.value = '';
                        placeholderOption.textContent = '-- Select Room Type --';
                        roomTypeSelect.appendChild(placeholderOption);
                        
                        // Add ONLY valid options from API
                        data.room_types.forEach(rt => {
                            const option = document.createElement('option');
                            option.value = rt.id;
                            option.textContent = rt.name;
                            roomTypeSelect.appendChild(option);
                            console.log(` [PACKAGE] Added room type: ${rt.name} (ID: ${rt.id})`);
                        });
                        
                        console.log(` [PACKAGE] Room type dropdown has ${roomTypeSelect.options.length} options now`);
                    }
                    
                    //  UPDATE MEAL PLAN DROPDOWN
                    const mealPlanSelect = document.querySelector('#houseboatBookingModal [name="meal_plan"]');
                    console.log('[PACKAGE] Meal plan select element:', mealPlanSelect);
                    
                    if (mealPlanSelect) {
                        // COMPLETELY REMOVE ALL OPTIONS
                        while (mealPlanSelect.options.length > 0) {
                            mealPlanSelect.remove(0);
                        }
                        console.log(' [PACKAGE] Cleared all meal plan options');
                        
                        // Add placeholder
                        const placeholderOption = document.createElement('option');
                        placeholderOption.value = '';
                        placeholderOption.textContent = '-- Select Meal Plan --';
                        mealPlanSelect.appendChild(placeholderOption);
                        
                        // Add ONLY valid options from API
                        data.meal_plans.forEach(mp => {
                            const option = document.createElement('option');
                            option.value = mp.id;
                            option.textContent = mp.name;
                            mealPlanSelect.appendChild(option);
                            console.log(` [PACKAGE] Added meal plan: ${mp.name} (ID: ${mp.id})`);
                        });
                        
                        console.log(` [PACKAGE] Meal plan dropdown has ${mealPlanSelect.options.length} options now`);
                    }
                    
                } else {
                    console.error(' [PACKAGE] API Error:', data.error);
                    alert(` ${data.error}`);
                }
            })
            .catch(error => {
                console.error(' [PACKAGE] Fetch error:', error);
            });
    }

    // ==========================================
    // MULTI-INCLUSION MANAGEMENT (HOTEL)
    // ==========================================
    let inclusionCounter = 0;
    let availableInclusions = [];

    // Package limits
    const packageAdults = parseInt(document.getElementById('packageDefaultAdults')?.value) || 2;
    const packageChildren = parseInt(document.getElementById('packageDefaultChildren')?.value) || 2;

    //  Add new inclusion row
    document.getElementById('addInclusionBtn')?.addEventListener('click', function() {
        const hotelId = document.getElementById('modalHotelId')?.value;
        
        if (!hotelId) {
            Swal.fire({
                icon: 'warning',
                title: 'Select Hotel First',
                text: 'Please select a hotel before adding inclusions',
                toast: true,
                position: 'top-end',
                showConfirmButton: false,
                timer: 3000
            });
            return;
        }
        
        inclusionCounter++;
        const container = document.getElementById('inclusionsContainer');
        
        const noInclusionsMsg = document.getElementById('noInclusionsMessage');
        if (noInclusionsMsg) noInclusionsMsg.style.display = 'none';
        
        const row = document.createElement('div');
        row.className = 'inclusion-row border rounded p-3 mb-3 bg-white';
        row.id = `inclusion-row-${inclusionCounter}`;
        row.dataset.index = inclusionCounter;
        
        row.innerHTML = `
            <div class="row align-items-end">
                <div class="col-md-4">
                    <label class="form-label fw-semibold">Special Inclusion *</label>
                    <select class="form-select inclusion-select" data-index="${inclusionCounter}" required>
                        <option value="">-- Loading... --</option>
                    </select>
                    <small class="text-muted pricing-info" data-index="${inclusionCounter}"></small>
                </div>
                <div class="col-md-3">
                    <label class="form-label">Adults</label>
                    <input type="number" class="form-control inclusion-adults" data-index="${inclusionCounter}" 
                        min="0" max="${packageAdults}" value="0">
                    <small class="text-muted">Max: ${packageAdults}</small>
                </div>
                <div class="col-md-3">
                    <label class="form-label">Children</label>
                    <input type="number" class="form-control inclusion-children" data-index="${inclusionCounter}" 
                        min="0" max="${packageChildren}" value="0">
                    <small class="text-muted">Max: ${packageChildren}</small>
                </div>
                <div class="col-md-2">
                    <button type="button" class="btn btn-danger btn-sm w-100" onclick="removeInclusion(${inclusionCounter})">
                        <i class="fas fa-trash"></i> Remove
                    </button>
                </div>
            </div>
            <div class="mt-2 p-2 bg-light rounded">
                <div class="d-flex justify-content-between align-items-center">
                    <small class="text-muted">
                        <i class="fas fa-calculator me-1"></i>Price:
                    </small>
                    <strong class="inclusion-price text-success" data-index="${inclusionCounter}">0.00</strong>
                </div>
            </div>
        `;
        
        container.appendChild(row);
        
        //  Load options for this specific row only once
        loadInclusionOptionsForRow(inclusionCounter, hotelId);
        
        //  Add event listeners WITH VALIDATION
        const selectEl = row.querySelector('.inclusion-select');
        const adultsEl = row.querySelector('.inclusion-adults');
        const childrenEl = row.querySelector('.inclusion-children');
        
        selectEl.addEventListener('change', function() {
            updateInclusionInfo(inclusionCounter);
            calculateAllInclusionsPrices();
        });
        
        // Adults validation
        adultsEl.addEventListener('input', function() {
            const maxAdults = parseInt(this.getAttribute('max'));
            const currentValue = parseInt(this.value) || 0;
            
            if (currentValue > maxAdults) {
                this.value = maxAdults;
                Swal.fire({
                    toast: true,
                    position: 'top-end',
                    icon: 'warning',
                    title: `Maximum ${maxAdults} adults allowed`,
                    showConfirmButton: false,
                    timer: 2000
                });
            }
            
            calculateAllInclusionsPrices();
        });
        
        // Children validation
        childrenEl.addEventListener('input', function() {
            const maxChildren = parseInt(this.getAttribute('max'));
            const currentValue = parseInt(this.value) || 0;
            
            if (currentValue > maxChildren) {
                this.value = maxChildren;
                Swal.fire({
                    toast: true,
                    position: 'top-end',
                    icon: 'warning',
                    title: `Maximum ${maxChildren} children allowed`,
                    showConfirmButton: false,
                    timer: 2000
                });
            }
            
            calculateAllInclusionsPrices();
        });
        
        // Show summary
        const summaryDiv = document.getElementById('inclusionsSummary');
        if (summaryDiv) summaryDiv.style.display = 'block';
        
        console.log(` Added inclusion row ${inclusionCounter}`);
    });

    //  Remove inclusion row
    function removeInclusion(index) {
        const row = document.getElementById(`inclusion-row-${index}`);
        if (row) {
            const selectEl = row.querySelector('.inclusion-select');
            const inclusionName = selectEl ? selectEl.options[selectEl.selectedIndex]?.text : 'this inclusion';
            
            Swal.fire({
                title: 'Remove Inclusion?',
                text: `Are you sure you want to remove ${inclusionName}?`,
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#d33',
                cancelButtonColor: '#6c757d',
                confirmButtonText: 'Yes, remove it',
                cancelButtonText: 'Cancel'
            }).then((result) => {
                if (result.isConfirmed) {
                    row.remove();
                    calculateAllInclusionsPrices();
                    
                    const remainingRows = document.querySelectorAll('.inclusion-row');
                    const noInclusionsMsg = document.getElementById('noInclusionsMessage');
                    if (remainingRows.length === 0 && noInclusionsMsg) {
                        noInclusionsMsg.style.display = 'block';
                        const summaryDiv = document.getElementById('inclusionsSummary');
                        if (summaryDiv) summaryDiv.style.display = 'none';
                    }
                    
                    Swal.fire({
                        toast: true,
                        position: 'top-end',
                        icon: 'success',
                        title: 'Inclusion removed',
                        showConfirmButton: false,
                        timer: 2000
                    });
                }
            });
        }
    }

    //  Load options ONCE per row
    function loadInclusionOptionsForRow(rowIndex, hotelId) {
        const select = document.querySelector(`.inclusion-select[data-index="${rowIndex}"]`);
        if (!select) {
            console.error(` Select not found for row ${rowIndex}`);
            return;
        }
        
        if (select.dataset.loaded === 'true' || select.dataset.loaded === 'loading') {
            console.log(` Options already loaded/loading for row ${rowIndex}`);
            return;
        }
        
        select.dataset.loaded = 'loading';
        console.log(` Loading options for row ${rowIndex}`);
        
        fetch(`/get-hotel-inclusions/${hotelId}/`)
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    availableInclusions = data.inclusions;
                    select.innerHTML = '<option value="">-- Select Inclusion --</option>';
                    
                    data.inclusions.forEach(inc => {
                        const option = document.createElement('option');
                        option.value = inc.id;
                        option.textContent = inc.name;
                        option.dataset.adultPrice = inc.adult_price;
                        option.dataset.childPrice = inc.child_price;
                        option.dataset.pricingType = inc.pricing_type;
                        select.appendChild(option);
                    });
                    
                    select.dataset.loaded = 'true';
                    console.log(` Loaded ${data.inclusions.length} options for row ${rowIndex}`);
                } else {
                    select.innerHTML = '<option value="">No inclusions available</option>';
                    select.dataset.loaded = 'error';
                }
            })
            .catch(error => {
                console.error(` Error loading inclusions for row ${rowIndex}:`, error);
                select.innerHTML = '<option value="">Error loading inclusions</option>';
                select.dataset.loaded = 'error';
            });
    }

    //  Update inclusion info display
    function updateInclusionInfo(index) {
        const row = document.getElementById(`inclusion-row-${index}`);
        if (!row) return;
        
        const select = row.querySelector('.inclusion-select');
        const infoEl = row.querySelector('.pricing-info');
        
        if (!select.value) {
            infoEl.textContent = '';
            return;
        }
        
        const selectedOption = select.options[select.selectedIndex];
        const pricingType = selectedOption.dataset.pricingType;
        const adultPrice = parseFloat(selectedOption.dataset.adultPrice);
        
        let infoText = '';
        if (pricingType === 'free') {
            infoText = ' Free inclusion';
        } else if (pricingType === 'per_person') {
            infoText = `${adultPrice}/adult`;
        } else if (pricingType === 'per_booking') {
            infoText = `${adultPrice} flat rate`;
        } else if (pricingType === 'per_room') {
            infoText = `${adultPrice}/room`;
        }
        
        infoEl.textContent = infoText;
        infoEl.classList.add('text-info');
    }

    //  Calculate prices for all inclusions
    function calculateAllInclusionsPrices() {
        let totalCost = 0;
        let summaryParts = [];
        
        document.querySelectorAll('.inclusion-row').forEach(row => {
            const index = row.dataset.index;
            const selectEl = row.querySelector('.inclusion-select');
            const adultsEl = row.querySelector('.inclusion-adults');
            const childrenEl = row.querySelector('.inclusion-children');
            const priceEl = row.querySelector('.inclusion-price');
            
            if (!selectEl.value) {
                priceEl.textContent = '0.00';
                return;
            }
            
            const selectedOption = selectEl.options[selectEl.selectedIndex];
            const adultPrice = parseFloat(selectedOption.dataset.adultPrice) || 0;
            const childPrice = parseFloat(selectedOption.dataset.childPrice) || 0;
            const pricingType = selectedOption.dataset.pricingType;
            const adults = parseInt(adultsEl.value) || 0;
            const children = parseInt(childrenEl.value) || 0;
            
            let itemPrice = 0;
            
            if (pricingType === 'per_person') {
                itemPrice = (adultPrice * adults) + (childPrice * children);
            } else if (pricingType === 'per_booking') {
                itemPrice = adultPrice;
            } else if (pricingType === 'per_room') {
                const numRooms = parseInt(document.getElementById('numDoubleBeds')?.value) || 1;
                itemPrice = adultPrice * numRooms;
            } else if (pricingType === 'free') {
                itemPrice = 0;
            }
            
            priceEl.textContent = `${itemPrice.toFixed(2)}`;
            totalCost += itemPrice;
            
            if (itemPrice > 0) {
                const inclusionName = selectedOption.textContent;
                summaryParts.push(`${inclusionName}: ${itemPrice.toFixed(2)}`);
            }
        });
        
        const totalCostEl = document.getElementById('totalInclusionCost');
        const summaryTextEl = document.getElementById('inclusionsSummaryText');
        const summaryDiv = document.getElementById('inclusionsSummary');
        
        if (totalCostEl) totalCostEl.textContent = `${totalCost.toFixed(2)}`;
        if (summaryTextEl) summaryTextEl.textContent = summaryParts.join(' | ');
        if (summaryDiv) summaryDiv.style.display = totalCost > 0 ? 'block' : 'none';
        
        console.log(` Total inclusions cost: ${totalCost.toFixed(2)}`);
    }

    //  Collect all inclusions data before form submit
    document.getElementById('hotelBookingForm')?.addEventListener('submit', function(e) {
        e.preventDefault();
        
        const inclusionsData = [];
        document.querySelectorAll('.inclusion-row').forEach(row => {
            const selectEl = row.querySelector('.inclusion-select');
            const adultsEl = row.querySelector('.inclusion-adults');
            const childrenEl = row.querySelector('.inclusion-children');
            
            if (selectEl.value && (adultsEl.value > 0 || childrenEl.value > 0)) {
                inclusionsData.push({
                    id: parseInt(selectEl.value),
                    adults: parseInt(adultsEl.value) || 0,
                    children: parseInt(childrenEl.value) || 0
                });
            }
        });
        
        document.getElementById('inclusionsData').value = JSON.stringify(inclusionsData);
        console.log(' Submitting inclusions:', inclusionsData);
        
        const formData = new FormData(this);
        const submitButton = this.querySelector('button[type="submit"]');
        const originalButtonText = submitButton.innerHTML;
        
        submitButton.disabled = true;
        submitButton.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>Saving...';
        
        fetch(this.action, {
            method: 'POST',
            body: formData,
            headers: {
                'X-Requested-With': 'XMLHttpRequest'
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                Swal.fire({
                    icon: 'success',
                    title: 'Success!',
                    text: data.message || 'Hotel booking saved successfully!',
                    timer: 2000,
                    showConfirmButton: false
                }).then(() => {
                    const modal = bootstrap.Modal.getInstance(document.getElementById('hotelBookingModal'));
                    modal.hide();
                    window.location.reload();
                });
            } else {
                submitButton.disabled = false;
                submitButton.innerHTML = originalButtonText;
                
                Swal.fire({
                    icon: 'error',
                    title: 'Validation Error',
                    html: data.errors ? data.errors.join('<br>') : (data.message || 'Please check the form and try again'),
                    confirmButtonText: 'OK'
                });
            }
        })
        .catch(error => {
            console.error('Error:', error);
            submitButton.disabled = false;
            submitButton.innerHTML = originalButtonText;
            
            Swal.fire({
                icon: 'error',
                title: 'Error',
                text: 'An error occurred. Please try again.',
                confirmButtonText: 'OK'
            });
        });
    });

    // ==========================================
    //  DATE VALIDATION FUNCTIONS
    // ==========================================
    function validateDateRange(dateInput, dateValue, packageFromDate, packageToDate) {
        if (!packageFromDate || !packageToDate) return true;
        
        const selectedDate = new Date(dateValue);
        const minDate = new Date(packageFromDate);
        const maxDate = new Date(packageToDate);
        
        if (selectedDate < minDate || selectedDate > maxDate) {
            dateInput.setCustomValidity('Date must be within the package date range');
            dateInput.classList.add('is-invalid');
            return false;
        } else {
            dateInput.setCustomValidity('');
            dateInput.classList.remove('is-invalid');
            return true;
        }
    }

    function formatDate(dateString) {
        const date = new Date(dateString);
        return date.toLocaleDateString('en-GB', { day: '2-digit', month: 'short', year: 'numeric' });
    }

    // ==========================================
    // BULK DELETE CONFIRMATION
    // ==========================================
    function bulkDeleteConfirm(type, dayNumber, count) {
        const typeDisplayMap = {
            'hotels': 'Hotels',
            'activities': 'Activities',
            'vehicles': 'Vehicles',
            'houseboats': 'Houseboats',
            'everything': 'ALL ITEMS'
        };
        
        const typeDisplay = typeDisplayMap[type] || type;
        const message = `Are you sure you want to delete ${typeDisplay.toUpperCase()} (${count} items) from Day ${dayNumber}?\n\nThis action cannot be undone!`;
        
        if (confirm(message)) {
            document.getElementById('deleteType').value = type;
            document.getElementById('deleteDayNumber').value = dayNumber;
            document.getElementById('bulkDeleteForm').submit();
        }
    }

// ==========================================
// DOCUMENT READY - INITIALIZE ALL MODALS
// ==========================================
document.addEventListener("DOMContentLoaded", function () {
    
    const packageFromDateEl = document.getElementById('packageFromDate');
    const packageToDateEl = document.getElementById('packageToDate');
    const packageFromDate = packageFromDateEl ? packageFromDateEl.value : null;
    const packageToDate = packageToDateEl ? packageToDateEl.value : null;
    
    const packageDefaultAdults = document.getElementById('packageDefaultAdults')?.value || 2;
    const packageDefaultChildren = document.getElementById('packageDefaultChildren')?.value || 0;
    const packageDefaultInfants = document.getElementById('packageDefaultInfants')?.value || 0;
    
    const activityPackageDefaultAdults = document.getElementById('activityPackageDefaultAdults')?.value || packageDefaultAdults;
    const activityPackageDefaultChildren = document.getElementById('activityPackageDefaultChildren')?.value || packageDefaultChildren;
    const activityPackageDefaultInfants = document.getElementById('activityPackageDefaultInfants')?.value || packageDefaultInfants;
    
    console.log(` Package Date Range: ${packageFromDate} to ${packageToDate}`);
    console.log(` Package Passengers: ${packageDefaultAdults} adults, ${packageDefaultChildren} children, ${packageDefaultInfants} infants`);
    
    //  DEBUG: Check if critical elements exist
    console.log(' Checking critical elements:');
    console.log('- addHouseboatInclusionBtn:', document.getElementById('addHouseboatInclusionBtn') ? ' Found' : ' Not found');
    console.log('- houseboatInclusionsContainer:', document.getElementById('houseboatInclusionsContainer') ? ' Found' : ' Not found');
    console.log('- houseboatBookingModal:', document.getElementById('houseboatBookingModal') ? ' Found' : ' Not found');

    // ==========================================
    //  HOUSEBOAT INCLUSIONS - DECLARE ONCE AT TOP
    // ==========================================
    let houseboatInclusionCounter = 0;

    // ==========================================
    //  SETUP VEHICLE PASSENGER AUTO-CALCULATION
    // ==========================================
    const passengerFields = document.querySelectorAll('.passenger-count');
    
    if (passengerFields.length > 0) {
        passengerFields.forEach(field => {
            field.addEventListener('input', calculateTotalPassengers);
            field.addEventListener('change', calculateTotalPassengers);
        });
        
        calculateTotalPassengers();
        console.log(' Vehicle passenger calculation initialized');
    }

    // ==========================================
    //  SETUP ACTIVITY PARTICIPANT AUTO-CALCULATION
    // ==========================================
    const activityParticipantFields = document.querySelectorAll('.activity-participant-count');
    
    if (activityParticipantFields.length > 0) {
        activityParticipantFields.forEach(field => {
            field.addEventListener('input', calculateTotalActivityParticipants);
            field.addEventListener('change', calculateTotalActivityParticipants);
        });
        
        calculateTotalActivityParticipants();
        console.log(' Activity participant calculation initialized');
    }

    // ==========================================
    //  SETUP DOUBLE BED INPUT FOR INCLUSION RECALCULATION
    // ==========================================
    const doubleBedInput = document.getElementById('numDoubleBeds');
    if (doubleBedInput) {
        doubleBedInput.addEventListener('input', calculateAllInclusionsPrices);
        doubleBedInput.addEventListener('change', calculateAllInclusionsPrices);
    }

    // ==========================================
    //  HOTEL BOOKING - DATE VALIDATION
    // ==========================================
    const checkinDateInput = document.getElementById('checkinDate');
    const checkoutDateInput = document.getElementById('checkoutDate');
    
    if (checkinDateInput && checkoutDateInput) {
        checkinDateInput.addEventListener('change', function() {
            const checkinDate = this.value;
            
            if (packageFromDate && packageToDate) {
                if (!validateDateRange(this, checkinDate, packageFromDate, packageToDate)) {
                    alert(`Check-in date must be between ${formatDate(packageFromDate)} and ${formatDate(packageToDate)}`);
                    this.value = '';
                    return;
                }
            }
            
            if (checkinDate) {
                checkoutDateInput.min = checkinDate;
                if (checkoutDateInput.value && checkoutDateInput.value < checkinDate) {
                    checkoutDateInput.value = '';
                }
            }
        });
        
        checkoutDateInput.addEventListener('change', function() {
            const checkoutDate = this.value;
            const checkinDate = checkinDateInput.value;
            
            if (packageFromDate && packageToDate) {
                if (!validateDateRange(this, checkoutDate, packageFromDate, packageToDate)) {
                    alert(`Check-out date must be between ${formatDate(packageFromDate)} and ${formatDate(packageToDate)}`);
                    this.value = '';
                    return;
                }
            }
            
            if (checkinDate && checkoutDate <= checkinDate) {
                alert('Check-out date must be after check-in date');
                this.value = '';
                this.classList.add('is-invalid');
            } else {
                this.classList.remove('is-invalid');
            }
        });
    }
    
    // ==========================================
    //  VEHICLE BOOKING - DATE VALIDATION
    // ==========================================
    const vehiclePickupDateInput = document.getElementById('vehiclePickupDate');
    
    if (vehiclePickupDateInput) {
        vehiclePickupDateInput.addEventListener('change', function() {
            const pickupDate = this.value;
            
            if (packageFromDate && packageToDate) {
                if (!validateDateRange(this, pickupDate, packageFromDate, packageToDate)) {
                    alert(`Pickup date must be between ${formatDate(packageFromDate)} and ${formatDate(packageToDate)}`);
                    this.value = '';
                    return;
                }
            }
        });
    }
    
    // ==========================================
    //  ACTIVITY BOOKING - DATE VALIDATION
    // ==========================================
    const activityBookingDateInput = document.getElementById('activityBookingDate');
    
    if (activityBookingDateInput) {
        activityBookingDateInput.addEventListener('change', function() {
            const bookingDate = this.value;
            
            if (packageFromDate && packageToDate) {
                if (!validateDateRange(this, bookingDate, packageFromDate, packageToDate)) {
                    alert(`Activity booking date must be between ${formatDate(packageFromDate)} and ${formatDate(packageToDate)}`);
                    this.value = '';
                    return;
                }
            }
        });
    }
    
    // ==========================================
    //  HOUSEBOAT BOOKING - DATE VALIDATION
    // ==========================================
    const houseboatCheckInInput = document.getElementById('houseboatCheckIn');
    const houseboatCheckOutInput = document.getElementById('houseboatCheckOut');
    
    if (houseboatCheckInInput && houseboatCheckOutInput) {
        houseboatCheckInInput.addEventListener('change', function() {
            const checkInDate = this.value;
            
            if (packageFromDate && packageToDate) {
                if (!validateDateRange(this, checkInDate, packageFromDate, packageToDate)) {
                    alert(`Houseboat check-in date must be between ${formatDate(packageFromDate)} and ${formatDate(packageToDate)}`);
                    this.value = '';
                    return;
                }
            }
            
            if (checkInDate) {
                houseboatCheckOutInput.min = checkInDate;
                if (houseboatCheckOutInput.value && houseboatCheckOutInput.value < checkInDate) {
                    houseboatCheckOutInput.value = '';
                }
            }
        });
        
        houseboatCheckOutInput.addEventListener('change', function() {
            const checkOutDate = this.value;
            const checkInDate = houseboatCheckInInput.value;
            
            if (packageFromDate && packageToDate) {
                if (!validateDateRange(this, checkOutDate, packageFromDate, packageToDate)) {
                    alert(`Houseboat check-out date must be between ${formatDate(packageFromDate)} and ${formatDate(packageToDate)}`);
                    this.value = '';
                    return;
                }
            }
            
            if (checkInDate && checkOutDate <= checkInDate) {
                alert('Houseboat check-out date must be after check-in date');
                this.value = '';
                this.classList.add('is-invalid');
            } else {
                this.classList.remove('is-invalid');
            }
        });
    }
    
    // ==========================================
    // EDIT DAY DETAILS MODAL
    // ==========================================
    const editDayDetailsModal = document.getElementById('editDayDetailsModal');
    if (editDayDetailsModal) {
        editDayDetailsModal.addEventListener('show.bs.modal', function (event) {
            const button = event.relatedTarget;
            document.getElementById('editDayNumber').value = button.dataset.dayNumber;
            document.getElementById('dayTitle').value = button.dataset.title || '';
            document.getElementById('dayDescription').value = button.dataset.description || '';
        });
        
        editDayDetailsModal.addEventListener('hidden.bs.modal', function () {
            document.getElementById('editDayNumber').value = '';
            document.getElementById('dayTitle').value = '';
            document.getElementById('dayDescription').value = '';
            document.getElementById('dayImage').value = '';
        });
    }
    
    // ==========================================
    // HOTEL BOOKING MODAL
    // ==========================================
    const hotelBookingModal = document.getElementById('hotelBookingModal');
    if (hotelBookingModal) {
        const hotelBookingForm = document.getElementById('hotelBookingForm');
        const hotelBookingTitle = document.getElementById('hotelBookingModalLabel');
        const createUrl = "{% url 'create_hotel_booking_for_package' package.id %}";
        const updateUrlTemplate = "{% url 'update_hotel_booking' 0 %}";

        hotelBookingModal.addEventListener('show.bs.modal', function (event) {
            const button = event.relatedTarget;
            const bookingId = button.getAttribute('data-booking-id');
            const hotelId = button.getAttribute('data-hotel-id');
            const packageId = {{ package.id }};

            document.getElementById('modalHotelId').value = hotelId || '';
            document.getElementById('modalDayNumber').value = button.getAttribute('data-day-number') || '';
            document.getElementById('modalHotelName').value = button.getAttribute('data-hotel-name') || '';

            if (bookingId) {
                // ==========================================
                // EDIT MODE - FIXED: No more infinite loop
                // ==========================================
                hotelBookingTitle.textContent = 'Edit Hotel Booking';
                hotelBookingForm.action = updateUrlTemplate.replace('0', bookingId);
                document.getElementById('modalBookingId').value = bookingId;
                
                document.getElementById('modalDestination').value = button.getAttribute('data-destination-id') || '';
                document.getElementById('hotelCategory').value = button.getAttribute('data-category') || '';
                document.getElementById('roomType').value = button.getAttribute('data-room-type-id') || '';
                document.getElementById('mealPlan').value = button.getAttribute('data-meal-plan-id') || '';
                document.getElementById('hotelOption').value = button.getAttribute('data-option') || 'option_1';
                
                document.getElementById('numDoubleBeds').value = button.getAttribute('data-num-double-beds') || '0';
                document.getElementById('childWithBed').value = button.getAttribute('data-child-with-bed') || '0';
                document.getElementById('childWithoutBed').value = button.getAttribute('data-child-without-bed') || '0';
                document.getElementById('extraBeds').value = button.getAttribute('data-extra-beds') || '0';
                document.getElementById('checkinDate').value = button.getAttribute('data-check-in-date') || '';
                document.getElementById('checkoutDate').value = button.getAttribute('data-check-out-date') || '';
                
                // Format time values
                let checkinTime = button.getAttribute('data-check-in-time') || '14:00';
                let checkoutTime = button.getAttribute('data-check-out-time') || '11:00';
                if (checkinTime.length > 5) checkinTime = checkinTime.substring(0, 5);
                if (checkoutTime.length > 5) checkoutTime = checkoutTime.substring(0, 5);
                document.getElementById('checkinTime').value = checkinTime;
                document.getElementById('checkoutTime').value = checkoutTime;
                
                //  LOAD EXISTING INCLUSIONS - SIMPLE VERSION (NO LOOP)
                const existingInclusionsJson = button.getAttribute('data-inclusions') || '[]';
                console.log(' Loading inclusions:', existingInclusionsJson);

                try {
                    const existingInclusions = JSON.parse(existingInclusionsJson);
                    
                    // Clear container
                    const container = document.getElementById('inclusionsContainer');
                    container.innerHTML = `
                        <div class="text-center text-muted py-4" id="noInclusionsMessage">
                            <i class="fas fa-info-circle me-2"></i>
                            No inclusions added yet. Click "Add Inclusion" to add special inclusions.
                        </div>
                    `;
                    inclusionCounter = 0;
                    
                    if (existingInclusions && existingInclusions.length > 0) {
                        console.log(` Found ${existingInclusions.length} inclusions to load`);
                        
                        //  PRE-FETCH inclusion options ONCE for all rows
                        fetch(`/get-hotel-inclusions/${hotelId}/`)
                            .then(response => response.json())
                            .then(data => {
                                if (data.success) {
                                    availableInclusions = data.inclusions;
                                    console.log(` Pre-fetched ${data.inclusions.length} inclusion options`);
                                    
                                    // Now add all inclusion rows quickly
                                    existingInclusions.forEach((inc, index) => {
                                        setTimeout(() => {
                                            inclusionCounter++;
                                            const rowIndex = inclusionCounter;
                                            
                                            // Hide "no inclusions" message
                                            const noInclusionsMsg = document.getElementById('noInclusionsMessage');
                                            if (noInclusionsMsg) noInclusionsMsg.style.display = 'none';
                                            
                                            // Create new row
                                            const row = document.createElement('div');
                                            row.className = 'inclusion-row border rounded p-3 mb-3 bg-white';
                                            row.id = `inclusion-row-${rowIndex}`;
                                            row.dataset.index = rowIndex;
                                            
                                            row.innerHTML = `
                                                <div class="row align-items-end">
                                                    <div class="col-md-4">
                                                        <label class="form-label fw-semibold">Special Inclusion *</label>
                                                        <select class="form-select inclusion-select" data-index="${rowIndex}" required>
                                                            <option value="">-- Select Inclusion --</option>
                                                        </select>
                                                        <small class="text-muted pricing-info" data-index="${rowIndex}"></small>
                                                    </div>
                                                    <div class="col-md-3">
                                                        <label class="form-label">Adults</label>
                                                        <input type="number" class="form-control inclusion-adults" data-index="${rowIndex}" 
                                                            min="0" max="${packageAdults}" value="${inc.adults || 0}">
                                                        <small class="text-muted">Max: ${packageAdults}</small>
                                                    </div>
                                                    <div class="col-md-3">
                                                        <label class="form-label">Children</label>
                                                        <input type="number" class="form-control inclusion-children" data-index="${rowIndex}" 
                                                            min="0" max="${packageChildren}" value="${inc.children || 0}">
                                                        <small class="text-muted">Max: ${packageChildren}</small>
                                                    </div>
                                                    <div class="col-md-2">
                                                        <button type="button" class="btn btn-danger btn-sm w-100" onclick="removeInclusion(${rowIndex})">
                                                            <i class="fas fa-trash"></i> Remove
                                                        </button>
                                                    </div>
                                                </div>
                                                <div class="mt-2 p-2 bg-light rounded">
                                                    <div class="d-flex justify-content-between align-items-center">
                                                        <small class="text-muted">
                                                            <i class="fas fa-calculator me-1"></i>Price:
                                                        </small>
                                                        <strong class="inclusion-price text-success" data-index="${rowIndex}">0.00</strong>
                                                    </div>
                                                </div>
                                            `;
                                            
                                            container.appendChild(row);
                                            
                                            // Populate select options from pre-fetched data
                                            const select = row.querySelector('.inclusion-select');
                                            data.inclusions.forEach(option => {
                                                const opt = document.createElement('option');
                                                opt.value = option.id;
                                                opt.textContent = option.name;
                                                opt.dataset.adultPrice = option.adult_price;
                                                opt.dataset.childPrice = option.child_price;
                                                opt.dataset.pricingType = option.pricing_type;
                                                select.appendChild(opt);
                                            });
                                            
                                            // Set the selected value
                                            select.value = inc.id;
                                            select.dataset.loaded = 'true';
                                            
                                            // Add event listeners with validation
                                            select.addEventListener('change', function() {
                                                updateInclusionInfo(rowIndex);
                                                calculateAllInclusionsPrices();
                                            });
                                            
                                            //  VALIDATION: Adults input with max limit enforcement
                                            const adultsInput = row.querySelector('.inclusion-adults');
                                            adultsInput.addEventListener('input', function() {
                                                const maxAdults = parseInt(this.getAttribute('max'));
                                                const currentValue = parseInt(this.value) || 0;
                                                
                                                if (currentValue > maxAdults) {
                                                    this.value = maxAdults;
                                                    Swal.fire({
                                                        toast: true,
                                                        position: 'top-end',
                                                        icon: 'warning',
                                                        title: `Maximum ${maxAdults} adults allowed`,
                                                        showConfirmButton: false,
                                                        timer: 2000
                                                    });
                                                }
                                                
                                                calculateAllInclusionsPrices();
                                            });
                                            
                                            //  VALIDATION: Children input with max limit enforcement
                                            const childrenInput = row.querySelector('.inclusion-children');
                                            childrenInput.addEventListener('input', function() {
                                                const maxChildren = parseInt(this.getAttribute('max'));
                                                const currentValue = parseInt(this.value) || 0;
                                                
                                                if (currentValue > maxChildren) {
                                                    this.value = maxChildren;
                                                    Swal.fire({
                                                        toast: true,
                                                        position: 'top-end',
                                                        icon: 'warning',
                                                        title: `Maximum ${maxChildren} children allowed`,
                                                        showConfirmButton: false,
                                                        timer: 2000
                                                    });
                                                }
                                                
                                                calculateAllInclusionsPrices();
                                            });
                                            
                                            // Update info and calculate price
                                            updateInclusionInfo(rowIndex);
                                            calculateAllInclusionsPrices();
                                            
                                            console.log(` Loaded inclusion ${index + 1}: ${select.options[select.selectedIndex]?.text}`);
                                            
                                            // Show summary on last inclusion
                                            if (index === existingInclusions.length - 1) {
                                                const summaryDiv = document.getElementById('inclusionsSummary');
                                                if (summaryDiv) summaryDiv.style.display = 'block';
                                            }
                                        }, index * 100); //  Only 100ms delay instead of 700ms
                                    });
                                }
                            })
                            .catch(error => {
                                console.error(' Error pre-fetching inclusions:', error);
                            });
                    }
                } catch (e) {
                    console.error(' Error parsing existing inclusions:', e);
                }
                
            } else {
                // ==========================================
                // CREATE MODE
                // ==========================================
                hotelBookingTitle.textContent = 'Create Hotel Booking';
                hotelBookingForm.action = createUrl;
                document.getElementById('modalBookingId').value = '';
                hotelBookingForm.reset();
                
                document.getElementById('modalHotelId').value = hotelId || '';
                document.getElementById('modalDayNumber').value = button.getAttribute('data-day-number') || '';
                document.getElementById('modalHotelName').value = button.getAttribute('data-hotel-name') || '';
                document.getElementById('modalDestination').value = button.getAttribute('data-destination-id') || '';
                
                if (packageFromDate) document.getElementById('checkinDate').value = packageFromDate;
                if (packageToDate) document.getElementById('checkoutDate').value = packageToDate;
                
                document.getElementById('checkinTime').value = '14:00';
                document.getElementById('checkoutTime').value = '11:00';
                document.getElementById('hotelOption').value = 'option_1';
                
                // Clear inclusions
                const container = document.getElementById('inclusionsContainer');
                if (container) {
                    container.innerHTML = `
                        <div class="text-center text-muted py-4" id="noInclusionsMessage">
                            <i class="fas fa-info-circle me-2"></i>
                            No inclusions added yet. Click "Add Inclusion" to add special inclusions.
                        </div>
                    `;
                }
                inclusionCounter = 0;
                
                // Fetch valid room types and meal plans
                if (hotelId) {
                    fetch(`/hotel/${hotelId}/valid-options/?package_id=${packageId}`)
                        .then(response => response.json())
                        .then(data => {
                            const roomTypeSelect = document.getElementById('roomType');
                            roomTypeSelect.innerHTML = '<option value="">-- Select Room Type --</option>';
                            data.room_types.forEach(rt => {
                                roomTypeSelect.innerHTML += `<option value="${rt.id}">${rt.name}</option>`;
                            });
                            
                            const mealPlanSelect = document.getElementById('mealPlan');
                            mealPlanSelect.innerHTML = '<option value="">-- Select Meal Plan --</option>';
                            data.meal_plans.forEach(mp => {
                                mealPlanSelect.innerHTML += `<option value="${mp.id}">${mp.name}</option>`;
                            });
                        })
                        .catch(error => {
                            console.error('Error fetching hotel options:', error);
                        });
                }
            }
        });

        //  CLEAN UP ON MODAL CLOSE
        hotelBookingModal.addEventListener('hidden.bs.modal', function () {
            hotelBookingTitle.textContent = 'Hotel Booking Details';
            hotelBookingForm.reset();
            hotelBookingForm.action = createUrl;
            document.getElementById('modalBookingId').value = '';
            
            const container = document.getElementById('inclusionsContainer');
            if (container) {
                container.querySelectorAll('.inclusion-row').forEach(row => row.remove());
                container.innerHTML = `
                    <div class="text-center text-muted py-4" id="noInclusionsMessage">
                        <i class="fas fa-info-circle me-2"></i>
                        No inclusions added yet.
                    </div>
                `;
            }
            
            const summaryDiv = document.getElementById('inclusionsSummary');
            if (summaryDiv) summaryDiv.style.display = 'none';
            
            inclusionCounter = 0;
            console.log(' Modal cleaned up');
        });
    }

    // ==========================================
    // ACTIVITY BOOKING MODAL
    // ==========================================
    const activityBookingModal = document.getElementById('activityBookingModal');
    if (activityBookingModal) {
        const form = activityBookingModal.querySelector('form');
        const title = document.getElementById('activityBookingModalLabel');
        const activityNameSpan = document.getElementById('modalActivityName');
        const editUrlPrototype = activityBookingModal.getAttribute('data-url-edit-prototype');
        const createUrl = "{% url 'create_activity_booking_for_package' package.id %}";

        activityBookingModal.addEventListener('show.bs.modal', function (event) {
            const button = event.relatedTarget;
            const bookingId = button.getAttribute('data-booking-id');

            const dayNumberField = form.querySelector('[name="day_number"]');
            const activityIdField = form.querySelector('[name="activity_id"]');
            
            if (dayNumberField) dayNumberField.value = button.getAttribute('data-day-number') || '';
            if (activityIdField) activityIdField.value = button.getAttribute('data-activity-id') || '';
            if (activityNameSpan) activityNameSpan.textContent = button.getAttribute('data-activity-name') || 'N/A';
            
            if (bookingId) {
                title.textContent = 'Edit Activity Booking';
                form.action = editUrlPrototype.replace('9999', bookingId);

                const bookingDateField = form.querySelector('[name="booking_date"]');
                const bookingTimeField = form.querySelector('[name="booking_time"]');
                const numAdultsField = form.querySelector('[name="num_adults"]');
                const numChildrenField = form.querySelector('[name="num_children"]');
                const numInfantsField = form.querySelector('[name="num_infants"]');
                const notesField = form.querySelector('[name="notes"]');

                if (bookingDateField) bookingDateField.value = button.getAttribute('data-booking-date') || '';
                if (bookingTimeField) bookingTimeField.value = button.getAttribute('data-booking-time') || '';
                if (numAdultsField) numAdultsField.value = button.getAttribute('data-num-adults') || '1';
                if (numChildrenField) numChildrenField.value = button.getAttribute('data-num-children') || '0';
                if (numInfantsField) numInfantsField.value = button.getAttribute('data-num-infants') || '0';
                if (notesField) notesField.value = button.getAttribute('data-notes') || '';
                
                setTimeout(calculateTotalActivityParticipants, 100);
            } else {
                title.textContent = 'Add Activity Booking';
                form.action = createUrl;
                form.reset();
                
                if (dayNumberField) dayNumberField.value = button.getAttribute('data-day-number') || '';
                if (activityIdField) activityIdField.value = button.getAttribute('data-activity-id') || '';
                if (activityNameSpan) activityNameSpan.textContent = button.getAttribute('data-activity-name') || 'N/A';
                
                const bookingDateField = form.querySelector('[name="booking_date"]');
                if (bookingDateField && packageFromDate) {
                    bookingDateField.value = packageFromDate;
                }
                
                const numAdultsField = form.querySelector('[name="num_adults"]');
                const numChildrenField = form.querySelector('[name="num_children"]');
                const numInfantsField = form.querySelector('[name="num_infants"]');
                
                if (numAdultsField) numAdultsField.value = activityPackageDefaultAdults;
                if (numChildrenField) numChildrenField.value = activityPackageDefaultChildren;
                if (numInfantsField) numInfantsField.value = activityPackageDefaultInfants;
                
                setTimeout(calculateTotalActivityParticipants, 100);
            }
        });

        activityBookingModal.addEventListener('hidden.bs.modal', function () {
            form.reset();
            title.textContent = 'Book Activity';
        });
    }
    
    // ==========================================
    // VEHICLE BOOKING MODAL
    // ==========================================
    const vehicleBookingModal = document.getElementById('bookVehicleModal');
    if (vehicleBookingModal) {
        const vehicleBookingForm = vehicleBookingModal.querySelector('form');
        const vehicleBookingTitle = document.getElementById('vehicleBookingModalLabel');
        const vehicleNameSpan = document.getElementById('modalVehicleName');
        const editUrlPrototype = vehicleBookingModal.getAttribute('data-url-edit-prototype');
        const createUrl = "{% url 'create_vehicle_booking_for_package' package.id %}";

        vehicleBookingModal.addEventListener('show.bs.modal', function (event) {
            const button = event.relatedTarget;
            const bookingId = button.getAttribute('data-booking-id');

            const vehicleIdField = vehicleBookingForm.querySelector('[name="vehicle_id"]');
            const dayNumberField = vehicleBookingForm.querySelector('[name="day_number"]');
            const destinationIdField = vehicleBookingForm.querySelector('[name="destination_id"]');
            
            if (vehicleIdField) vehicleIdField.value = button.getAttribute('data-vehicle-id') || '';
            if (dayNumberField) dayNumberField.value = button.getAttribute('data-day-number') || '';
            if (destinationIdField) destinationIdField.value = button.getAttribute('data-destination-id') || '';
            if (vehicleNameSpan) vehicleNameSpan.textContent = button.getAttribute('data-vehicle-name') || 'N/A';

            if (bookingId) {
                vehicleBookingTitle.textContent = 'Edit Vehicle Booking';
                vehicleBookingForm.action = editUrlPrototype.replace('9999', bookingId);
                
                const fields = {
                    pickup_date: button.getAttribute('data-pickup-date'),
                    pickup_time: button.getAttribute('data-pickup-time'),
                    num_adults: button.getAttribute('data-num-adults'),
                    num_children: button.getAttribute('data-num-children'),
                    num_infants: button.getAttribute('data-num-infants'),
                    vehicle_type: button.getAttribute('data-vehicle-type'),
                    option: button.getAttribute('data-option'),
                    total_km: button.getAttribute('data-total-km')
                };
                
                Object.keys(fields).forEach(fieldName => {
                    const field = vehicleBookingForm.querySelector(`[name="${fieldName}"]`);
                    if (field) field.value = fields[fieldName] || '0';
                });

                setTimeout(calculateTotalPassengers, 100);
            }
        });

        vehicleBookingModal.addEventListener('hidden.bs.modal', function () {
            vehicleBookingTitle.textContent = 'Book Vehicle';
            vehicleBookingForm.reset();
            vehicleBookingForm.action = createUrl;
        });
    }

    // ==========================================
    // HOUSEBOAT BOOKING MODAL
    // ==========================================
    const houseboatModal = document.getElementById('houseboatBookingModal');
    if (houseboatModal) {
        const modalTitle = document.getElementById('houseboatBookingModalLabel');
        const houseboatForm = document.getElementById('houseboatBookingForm');
        const editUrlPrototype = houseboatModal.getAttribute('data-url-edit-prototype');
        const createUrl = "{% url 'create_houseboat_booking_for_package' package.id %}";
        
        //  Get houseboat-specific package defaults
        const houseboatPackageDefaultAdults = parseInt(document.getElementById('houseboatPackageDefaultAdults')?.value) || 2;
        const houseboatPackageDefaultChildren = parseInt(document.getElementById('houseboatPackageDefaultChildren')?.value) || 0;
        
        console.log(` Houseboat Package Defaults: ${houseboatPackageDefaultAdults} adults, ${houseboatPackageDefaultChildren} children`);

        houseboatModal.addEventListener('show.bs.modal', function (event) {
            const button = event.relatedTarget;
            const bookingId = button.getAttribute('data-booking-id');
            const houseboatId = button.getAttribute('data-houseboat-id');
            const houseboatName = button.getAttribute('data-houseboat-name');
            const dayNumber = button.getAttribute('data-day-number');

            document.getElementById('modalHouseboatId').value = houseboatId || '';
            document.getElementById('houseboatModalDayNumber').value = dayNumber || '';
            document.getElementById('modalHouseboatName').textContent = houseboatName || 'N/A';

            if (bookingId) {
                // EDIT MODE
                modalTitle.textContent = 'Edit Houseboat Booking';
                houseboatForm.action = editUrlPrototype.replace('9999', bookingId);

                const checkInDate = button.getAttribute('data-check-in-date');
                const checkOutDate = button.getAttribute('data-check-out-date');
                
                houseboatForm.querySelector('[name="check_in_date"]').value = checkInDate || '';
                houseboatForm.querySelector('[name="check_out_date"]').value = checkOutDate || '';
                
                //  Load valid options
                if (houseboatId && checkInDate && checkOutDate) {
                    loadValidHouseboatOptionsForPackage(houseboatId, checkInDate, checkOutDate);
                }
                
                setTimeout(() => {
                    const mealPlanId = button.getAttribute('data-meal-plan-id');
                    const roomTypeId = button.getAttribute('data-room-type-id');
                    
                    if (mealPlanId) houseboatForm.querySelector('[name="meal_plan"]').value = mealPlanId;
                    if (roomTypeId) houseboatForm.querySelector('[name="room_type"]').value = roomTypeId;
                }, 500);
                
                // Set room config
                const roomFields = [
                    'num_one_bed_rooms', 'num_two_bed_rooms', 'num_three_bed_rooms', 'num_four_bed_rooms',
                    'num_five_bed_rooms', 'num_six_bed_rooms', 'num_seven_bed_rooms', 'num_eight_bed_rooms',
                    'num_nine_bed_rooms', 'num_ten_bed_rooms', 'num_extra_beds'
                ];
                
                roomFields.forEach(fieldName => {
                    const field = houseboatForm.querySelector(`[name="${fieldName}"]`);
                    const dataAttr = 'data-' + fieldName.replace(/_/g, '-');
                    if (field) field.value = button.getAttribute(dataAttr) || '0';
                });
                
                // Load inclusions
                const existingInclusionsJson = button.getAttribute('data-inclusions') || '[]';
                try {
                    const existingInclusions = JSON.parse(existingInclusionsJson);
                    const container = document.getElementById('houseboatInclusionsContainer');
                    container.innerHTML = '<div class="text-center text-muted py-4" id="houseboatNoInclusionsMessage"><i class="fas fa-info-circle me-2"></i>No inclusions added yet.</div>';
                    houseboatInclusionCounter = 0;
                    
                    if (existingInclusions && existingInclusions.length > 0) {
                        console.log(` Found ${existingInclusions.length} houseboat inclusions to load`);
                        
                        //  PRE-FETCH inclusion options ONCE for all rows
                        fetch(`/get-houseboat-inclusions/${houseboatId}/`)
                            .then(response => response.json())
                            .then(data => {
                                if (data.success) {
                                    console.log(` Pre-fetched ${data.inclusions.length} houseboat inclusion options`);
                                    
                                    // Now add all inclusion rows quickly
                                    existingInclusions.forEach((inc, index) => {
                                        setTimeout(() => {
                                            houseboatInclusionCounter++;
                                            const rowIndex = houseboatInclusionCounter;
                                            
                                            // Hide "no inclusions" message
                                            const noInclusionsMsg = document.getElementById('houseboatNoInclusionsMessage');
                                            if (noInclusionsMsg) noInclusionsMsg.style.display = 'none';
                                            
                                            // Create new row
                                            const row = document.createElement('div');
                                            row.className = 'houseboat-inclusion-row border rounded p-3 mb-3 bg-white shadow-sm';
                                            row.id = `houseboat-inclusion-row-${rowIndex}`;
                                            row.dataset.index = rowIndex;
                                            
                                            row.innerHTML = `
                                                <div class="row align-items-end">
                                                    <div class="col-md-4">
                                                        <label class="form-label fw-semibold">
                                                            <i class="fas fa-gift text-warning me-1"></i>
                                                            Special Inclusion *
                                                        </label>
                                                        <select class="form-select houseboat-inclusion-select" data-index="${rowIndex}" required>
                                                            <option value="">-- Select Inclusion --</option>
                                                        </select>
                                                        <small class="text-muted houseboat-pricing-info" data-index="${rowIndex}"></small>
                                                    </div>
                                                    <div class="col-md-3">
                                                        <label class="form-label">
                                                            <i class="fas fa-user text-primary me-1"></i>
                                                            Adults
                                                        </label>
                                                        <input type="number" class="form-control houseboat-inclusion-adults" data-index="${rowIndex}" 
                                                            min="0" max="${houseboatPackageDefaultAdults}" value="${inc.adults || 0}">
                                                        <small class="text-muted">Max: ${houseboatPackageDefaultAdults}</small>
                                                    </div>
                                                    <div class="col-md-3">
                                                        <label class="form-label">
                                                            <i class="fas fa-child text-info me-1"></i>
                                                            Children
                                                        </label>
                                                        <input type="number" class="form-control houseboat-inclusion-children" data-index="${rowIndex}" 
                                                            min="0" max="${houseboatPackageDefaultChildren}" value="${inc.children || 0}">
                                                        <small class="text-muted">Max: ${houseboatPackageDefaultChildren}</small>
                                                    </div>
                                                    <div class="col-md-2">
                                                        <button type="button" class="btn btn-danger btn-sm w-100" onclick="removeHouseboatInclusion(${rowIndex})">
                                                            <i class="fas fa-trash"></i> Remove
                                                        </button>
                                                    </div>
                                                </div>
                                                <div class="mt-2 p-2 bg-light rounded">
                                                    <div class="d-flex justify-content-between align-items-center">
                                                        <small class="text-muted">
                                                            <i class="fas fa-calculator me-1"></i>Price:
                                                        </small>
                                                        <strong class="houseboat-inclusion-price text-success" data-index="${rowIndex}">0.00</strong>
                                                    </div>
                                                </div>
                                            `;
                                            
                                            container.appendChild(row);
                                            
                                            // Populate select options from pre-fetched data
                                            const select = row.querySelector('.houseboat-inclusion-select');
                                            data.inclusions.forEach(option => {
                                                const opt = document.createElement('option');
                                                opt.value = option.id;
                                                opt.textContent = option.name;
                                                opt.dataset.adultPrice = option.adult_price;
                                                opt.dataset.childPrice = option.child_price;
                                                opt.dataset.pricingType = option.pricing_type;
                                                select.appendChild(opt);
                                            });
                                            
                                            // Set the selected value
                                            select.value = inc.id;
                                            select.dataset.loaded = 'true';
                                            
                                            // Add event listeners with validation
                                            select.addEventListener('change', function() {
                                                updateHouseboatInclusionInfo(rowIndex);
                                                calculateAllHouseboatInclusionsPrices();
                                            });
                                            
                                            // Adults validation
                                            const adultsInput = row.querySelector('.houseboat-inclusion-adults');
                                            adultsInput.addEventListener('input', function() {
                                                const maxAdults = parseInt(this.getAttribute('max'));
                                                const currentValue = parseInt(this.value) || 0;
                                                
                                                if (currentValue > maxAdults) {
                                                    this.value = maxAdults;
                                                    Swal.fire({
                                                        toast: true,
                                                        position: 'top-end',
                                                        icon: 'warning',
                                                        title: `Maximum ${maxAdults} adults allowed`,
                                                        showConfirmButton: false,
                                                        timer: 2000
                                                    });
                                                }
                                                
                                                calculateAllHouseboatInclusionsPrices();
                                            });
                                            
                                            // Children validation
                                            const childrenInput = row.querySelector('.houseboat-inclusion-children');
                                            childrenInput.addEventListener('input', function() {
                                                const maxChildren = parseInt(this.getAttribute('max'));
                                                const currentValue = parseInt(this.value) || 0;
                                                
                                                if (currentValue > maxChildren) {
                                                    this.value = maxChildren;
                                                    Swal.fire({
                                                        toast: true,
                                                        position: 'top-end',
                                                        icon: 'warning',
                                                        title: `Maximum ${maxChildren} children allowed`,
                                                        showConfirmButton: false,
                                                        timer: 2000
                                                    });
                                                }
                                                
                                                calculateAllHouseboatInclusionsPrices();
                                            });
                                            
                                            //  CRITICAL: Update info and calculate price IMMEDIATELY
                                            updateHouseboatInclusionInfo(rowIndex);
                                            calculateAllHouseboatInclusionsPrices();
                                            
                                            console.log(` Loaded houseboat inclusion ${index + 1}: ${select.options[select.selectedIndex]?.text}`);
                                            
                                            // Show summary on last inclusion
                                            if (index === existingInclusions.length - 1) {
                                                const summaryDiv = document.getElementById('houseboatInclusionsSummary');
                                                if (summaryDiv) summaryDiv.style.display = 'block';
                                            }
                                        }, index * 100); //  Only 100ms delay
                                    });
                                } else {
                                    console.error(' Failed to fetch houseboat inclusion options');
                                }
                            })
                            .catch(error => {
                                console.error(' Error pre-fetching houseboat inclusions:', error);
                            });
                    }
                } catch (e) {
                    console.error(' Error parsing houseboat inclusions:', e);
                }
                
            } else {
                // CREATE MODE
                modalTitle.textContent = 'Add Houseboat Booking';
                houseboatForm.action = createUrl;
                houseboatForm.reset();

                document.getElementById('modalHouseboatId').value = houseboatId || '';
                document.getElementById('houseboatModalDayNumber').value = dayNumber || '';
                document.getElementById('modalHouseboatName').textContent = houseboatName || 'N/A';
                
                if (packageFromDate) houseboatForm.querySelector('[name="check_in_date"]').value = packageFromDate;
                if (packageToDate) houseboatForm.querySelector('[name="check_out_date"]').value = packageToDate;
                
                if (houseboatId && packageFromDate && packageToDate) {
                    loadValidHouseboatOptionsForPackage(houseboatId, packageFromDate, packageToDate);
                }
                
                const container = document.getElementById('houseboatInclusionsContainer');
                if (container) {
                    container.innerHTML = '<div class="text-center text-muted py-4" id="houseboatNoInclusionsMessage"><i class="fas fa-info-circle me-2"></i>No inclusions added yet.</div>';
                }
                houseboatInclusionCounter = 0;
                
                const summaryDiv = document.getElementById('houseboatInclusionsSummary');
                if (summaryDiv) summaryDiv.style.display = 'none';
            }
        });

        houseboatModal.addEventListener('hidden.bs.modal', function () {
            modalTitle.textContent = 'Houseboat Booking';
            houseboatForm.reset();
            houseboatForm.action = createUrl;
            
            const container = document.getElementById('houseboatInclusionsContainer');
            if (container) {
                container.querySelectorAll('.houseboat-inclusion-row').forEach(row => row.remove());
                container.innerHTML = '<div class="text-center text-muted py-4" id="houseboatNoInclusionsMessage"><i class="fas fa-info-circle me-2"></i>No inclusions added yet.</div>';
            }
            
            const summaryDiv = document.getElementById('houseboatInclusionsSummary');
            if (summaryDiv) summaryDiv.style.display = 'none';
            
            houseboatInclusionCounter = 0;
        });
        
        //  FORM SUBMISSION
        houseboatForm.addEventListener('submit', function(e) {
            const inclusionsData = [];
            document.querySelectorAll('.houseboat-inclusion-row').forEach(row => {
                const selectEl = row.querySelector('.houseboat-inclusion-select');
                const adultsEl = row.querySelector('.houseboat-inclusion-adults');
                const childrenEl = row.querySelector('.houseboat-inclusion-children');
                
                if (selectEl && selectEl.value && (adultsEl.value > 0 || childrenEl.value > 0)) {
                    inclusionsData.push({
                        id: parseInt(selectEl.value),
                        adults: parseInt(adultsEl.value) || 0,
                        children: parseInt(childrenEl.value) || 0
                    });
                }
            });
            
            document.getElementById('houseboatInclusionsData').value = JSON.stringify(inclusionsData);
            console.log(' Submitting houseboat inclusions:', inclusionsData);
        });
        
        //  DATE CHANGE LISTENERS
        const hbCheckinInput = document.getElementById('houseboatCheckIn');
        const hbCheckoutInput = document.getElementById('houseboatCheckOut');
        
        if (hbCheckinInput) {
            hbCheckinInput.addEventListener('change', function() {
                const houseboatId = document.getElementById('modalHouseboatId')?.value;
                const checkInDate = this.value;
                const checkOutDate = document.getElementById('houseboatCheckOut')?.value;
                
                if (houseboatId && checkInDate && checkOutDate) {
                    loadValidHouseboatOptionsForPackage(houseboatId, checkInDate, checkOutDate);
                }
            });
        }
        
        if (hbCheckoutInput) {
            hbCheckoutInput.addEventListener('change', function() {
                const houseboatId = document.getElementById('modalHouseboatId')?.value;
                const checkInDate = document.getElementById('houseboatCheckIn')?.value;
                const checkOutDate = this.value;
                
                if (houseboatId && checkInDate && checkOutDate) {
                    loadValidHouseboatOptionsForPackage(houseboatId, checkInDate, checkOutDate);
                }
            });
        }
    }

    // ==========================================
    // HOUSEBOAT INCLUSIONS MANAGEMENT FUNCTIONS
    // ==========================================
    
    //  ADD HOUSEBOAT INCLUSION ROW
    const addHouseboatInclusionBtn = document.getElementById('addHouseboatInclusionBtn');
    if (addHouseboatInclusionBtn) {
        console.log(' addHouseboatInclusionBtn found, attaching event listener');
        
        addHouseboatInclusionBtn.addEventListener('click', function() {
            const houseboatId = document.getElementById('modalHouseboatId')?.value;
            
            if (!houseboatId) {
                Swal.fire({
                    icon: 'warning',
                    title: 'Select Houseboat First',
                    text: 'Please select a houseboat before adding inclusions',
                    toast: true,
                    position: 'top-end',
                    showConfirmButton: false,
                    timer: 3000
                });
                return;
            }
            
            houseboatInclusionCounter++;
            const container = document.getElementById('houseboatInclusionsContainer');
            
            const noInclusionsMsg = document.getElementById('houseboatNoInclusionsMessage');
            if (noInclusionsMsg) noInclusionsMsg.style.display = 'none';
            
            const rowIndex = houseboatInclusionCounter;
            
            // Get package defaults
            const houseboatPackageDefaultAdults = parseInt(document.getElementById('houseboatPackageDefaultAdults')?.value) || 2;
            const houseboatPackageDefaultChildren = parseInt(document.getElementById('houseboatPackageDefaultChildren')?.value) || 0;
            
            const row = document.createElement('div');
            row.className = 'houseboat-inclusion-row border rounded p-3 mb-3 bg-white shadow-sm';
            row.id = `houseboat-inclusion-row-${rowIndex}`;
            row.dataset.index = rowIndex;
            
            row.innerHTML = `
                <div class="row align-items-end">
                    <div class="col-md-4">
                        <label class="form-label fw-semibold">
                            <i class="fas fa-gift text-warning me-1"></i>
                            Special Inclusion *
                        </label>
                        <select class="form-select houseboat-inclusion-select" data-index="${rowIndex}" required>
                            <option value="">Loading inclusions...</option>
                        </select>
                        <small class="text-muted houseboat-pricing-info" data-index="${rowIndex}"></small>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">
                            <i class="fas fa-user text-primary me-1"></i>
                            Adults
                        </label>
                        <input type="number" class="form-control houseboat-inclusion-adults" data-index="${rowIndex}" 
                            min="0" max="${houseboatPackageDefaultAdults}" value="0">
                        <small class="text-muted">Max: ${houseboatPackageDefaultAdults}</small>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">
                            <i class="fas fa-child text-info me-1"></i>
                            Children
                        </label>
                        <input type="number" class="form-control houseboat-inclusion-children" data-index="${rowIndex}" 
                            min="0" max="${houseboatPackageDefaultChildren}" value="0">
                        <small class="text-muted">Max: ${houseboatPackageDefaultChildren}</small>
                    </div>
                    <div class="col-md-2">
                        <button type="button" class="btn btn-danger btn-sm w-100" onclick="removeHouseboatInclusion(${rowIndex})">
                            <i class="fas fa-trash"></i> Remove
                        </button>
                    </div>
                </div>
                <div class="mt-2 p-2 bg-light rounded">
                    <div class="d-flex justify-content-between align-items-center">
                        <small class="text-muted">
                            <i class="fas fa-calculator me-1"></i>Price:
                        </small>
                        <strong class="houseboat-inclusion-price text-success" data-index="${rowIndex}">0.00</strong>
                    </div>
                </div>
            `;
            
            container.appendChild(row);
            
            //  FETCH HOUSEBOAT INCLUSIONS FROM API
            console.log(` Fetching houseboat inclusions for houseboat ${houseboatId}`);
            
            fetch(`/get-houseboat-inclusions/${houseboatId}/`)
                .then(response => response.json())
                .then(data => {
                    const select = row.querySelector('.houseboat-inclusion-select');
                    
                    if (data.success && data.inclusions.length > 0) {
                        select.innerHTML = '<option value="">-- Select Inclusion --</option>';
                        
                        data.inclusions.forEach(inc => {
                            const option = document.createElement('option');
                            option.value = inc.id;
                            option.textContent = inc.name;
                            option.dataset.adultPrice = inc.adult_price;
                            option.dataset.childPrice = inc.child_price;
                            option.dataset.pricingType = inc.pricing_type;
                            select.appendChild(option);
                        });
                        
                        console.log(` Loaded ${data.inclusions.length} houseboat inclusions for row ${rowIndex}`);
                    } else {
                        select.innerHTML = '<option value="">No inclusions available</option>';
                        console.warn(` No houseboat inclusions available for houseboat ${houseboatId}`);
                    }
                })
                .catch(error => {
                    console.error(` Error loading houseboat inclusions for row ${rowIndex}:`, error);
                    const select = row.querySelector('.houseboat-inclusion-select');
                    select.innerHTML = '<option value="">Error loading inclusions</option>';
                });
            
            // Add event listeners
            row.querySelector('.houseboat-inclusion-select').addEventListener('change', function() {
                updateHouseboatInclusionInfo(rowIndex);
                calculateAllHouseboatInclusionsPrices();
            });
            
            //  VALIDATION: Adults input with max limit enforcement
            row.querySelector('.houseboat-inclusion-adults').addEventListener('input', function() {
                const maxAdults = parseInt(this.max);
                const currentValue = parseInt(this.value) || 0;
                
                if (currentValue > maxAdults) {
                    this.value = maxAdults;
                    Swal.fire({
                        toast: true,
                        position: 'top-end',
                        icon: 'warning',
                        title: `Maximum ${maxAdults} adults allowed`,
                        showConfirmButton: false,
                        timer: 2000
                    });
                }
                
                calculateAllHouseboatInclusionsPrices();
            });
            
            //  VALIDATION: Children input with max limit enforcement
            row.querySelector('.houseboat-inclusion-children').addEventListener('input', function() {
                const maxChildren = parseInt(this.max);
                const currentValue = parseInt(this.value) || 0;
                
                if (currentValue > maxChildren) {
                    this.value = maxChildren;
                    Swal.fire({
                        toast: true,
                        position: 'top-end',
                        icon: 'warning',
                        title: `Maximum ${maxChildren} children allowed`,
                        showConfirmButton: false,
                        timer: 2000
                    });
                }
                
                calculateAllHouseboatInclusionsPrices();
            });
            
            // Show summary
            const summaryDiv = document.getElementById('houseboatInclusionsSummary');
            if (summaryDiv) summaryDiv.style.display = 'block';
            
            console.log(` Added houseboat inclusion row ${rowIndex}`);
        });
    } else {
        console.error(' addHouseboatInclusionBtn not found in DOM');
    }

    //  REMOVE HOUSEBOAT INCLUSION ROW (GLOBAL FUNCTION)
    window.removeHouseboatInclusion = function(index) {
        const row = document.getElementById(`houseboat-inclusion-row-${index}`);
        if (row) {
            const selectEl = row.querySelector('.houseboat-inclusion-select');
            const inclusionName = selectEl ? selectEl.options[selectEl.selectedIndex]?.text : 'this inclusion';
            
            Swal.fire({
                title: 'Remove Inclusion?',
                text: `Are you sure you want to remove ${inclusionName}?`,
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#d33',
                cancelButtonColor: '#6c757d',
                confirmButtonText: 'Yes, remove it',
                cancelButtonText: 'Cancel'
            }).then((result) => {
                if (result.isConfirmed) {
                    row.remove();
                    calculateAllHouseboatInclusionsPrices();
                    
                    const remainingRows = document.querySelectorAll('.houseboat-inclusion-row');
                    const noInclusionsMsg = document.getElementById('houseboatNoInclusionsMessage');
                    if (remainingRows.length === 0 && noInclusionsMsg) {
                        noInclusionsMsg.style.display = 'block';
                        const summaryDiv = document.getElementById('houseboatInclusionsSummary');
                        if (summaryDiv) summaryDiv.style.display = 'none';
                    }
                    
                    Swal.fire({
                        toast: true,
                        position: 'top-end',
                        icon: 'success',
                        title: 'Inclusion removed',
                        showConfirmButton: false,
                        timer: 2000
                    });
                }
            });
        }
    };

    //  UPDATE HOUSEBOAT INCLUSION INFO DISPLAY
    function updateHouseboatInclusionInfo(index) {
        const row = document.getElementById(`houseboat-inclusion-row-${index}`);
        if (!row) return;
        
        const select = row.querySelector('.houseboat-inclusion-select');
        const infoEl = row.querySelector('.houseboat-pricing-info');
        
        if (!select.value) {
            infoEl.textContent = '';
            return;
        }
        
        const selectedOption = select.options[select.selectedIndex];
        const pricingType = selectedOption.dataset.pricingType;
        const adultPrice = parseFloat(selectedOption.dataset.adultPrice);
        
        let infoText = '';
        if (pricingType === 'free') {
            infoText = ' Free inclusion';
        } else if (pricingType === 'per_person') {
            infoText = `${adultPrice}/adult`;
        } else if (pricingType === 'per_booking') {
            infoText = `${adultPrice} flat rate`;
        } else if (pricingType === 'per_boat') {
            infoText = `${adultPrice}/boat`;
        }
        
        infoEl.textContent = infoText;
        infoEl.classList.add('text-info');
    }

    //  CALCULATE PRICES FOR ALL HOUSEBOAT INCLUSIONS
    function calculateAllHouseboatInclusionsPrices() {
        let totalCost = 0;
        let summaryParts = [];
        
        document.querySelectorAll('.houseboat-inclusion-row').forEach(row => {
            const index = row.dataset.index;
            const selectEl = row.querySelector('.houseboat-inclusion-select');
            const adultsEl = row.querySelector('.houseboat-inclusion-adults');
            const childrenEl = row.querySelector('.houseboat-inclusion-children');
            const priceEl = row.querySelector('.houseboat-inclusion-price');
            
            if (!selectEl.value) {
                priceEl.textContent = '0.00';
                return;
            }
            
            const selectedOption = selectEl.options[selectEl.selectedIndex];
            const adultPrice = parseFloat(selectedOption.dataset.adultPrice) || 0;
            const childPrice = parseFloat(selectedOption.dataset.childPrice) || 0;
            const pricingType = selectedOption.dataset.pricingType;
            const adults = parseInt(adultsEl.value) || 0;
            const children = parseInt(childrenEl.value) || 0;
            
            let itemPrice = 0;
            
            if (pricingType === 'per_person') {
                itemPrice = (adultPrice * adults) + (childPrice * children);
            } else if (pricingType === 'per_booking') {
                itemPrice = adultPrice;
            } else if (pricingType === 'per_boat') {
                itemPrice = adultPrice;
            } else if (pricingType === 'free') {
                itemPrice = 0;
            }
            
            priceEl.textContent = `${itemPrice.toFixed(2)}`;
            totalCost += itemPrice;
            
            if (itemPrice > 0) {
                const inclusionName = selectedOption.textContent;
                summaryParts.push(`${inclusionName}: ${itemPrice.toFixed(2)}`);
            }
        });
        
        const totalCostEl = document.getElementById('houseboatTotalInclusionCost');
        const summaryTextEl = document.getElementById('houseboatInclusionsSummaryText');
        const summaryDiv = document.getElementById('houseboatInclusionsSummary');
        
        if (totalCostEl) totalCostEl.textContent = `${totalCost.toFixed(2)}`;
        if (summaryTextEl) summaryTextEl.textContent = summaryParts.join(' | ');
        if (summaryDiv) summaryDiv.style.display = totalCost > 0 ? 'block' : 'none';
        
        console.log(` Total houseboat inclusions cost: ${totalCost.toFixed(2)}`);
    }

    //  END OF DOMContentLoaded
    console.log(' All modal event listeners initialized successfully');

    });
                vehicleBookingTitle.textContent = 'Book Vehicle';
                vehicleBookingForm.action = createUrl;
                vehicleBookingForm.reset();
                
                if (vehicleIdField) vehicleIdField.value = button.getAttribute('data-vehicle-id') || '';
                if (dayNumberField) dayNumberField.value = button.getAttribute('data-day-number') || '';
                if (destinationIdField) destinationIdField.value = button.getAttribute('data-destination-id') || '';
                if (vehicleNameSpan) vehicleNameSpan.textContent = button.getAttribute('data-vehicle-name') || 'N/A';
                
                const pickupDateField = vehicleBookingForm.querySelector('[name="pickup_date"]');
                const numAdultsField = vehicleBookingForm.querySelector('[name="num_adults"]');
                const numChildrenField = vehicleBookingForm.querySelector('[name="num_children"]');
                const numInfantsField = vehicleBookingForm.querySelector('[name="num_infants"]');
                
                if (pickupDateField && packageFromDate) {
                    pickupDateField.value = packageFromDate;
                }
                
                if (numAdultsField) numAdultsField.value = packageDefaultAdults;
                if (numChildrenField) numChildrenField.value = packageDefaultChildren;
                if (numInfantsField) numInfantsField.value = packageDefaultInfants;
                
                setTimeout(calculateTotalPassengers, 100);

</script>

{% endblock %}
