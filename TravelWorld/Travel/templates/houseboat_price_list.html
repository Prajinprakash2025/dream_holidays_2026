{% extends 'base.html' %}
{% load widget_tweaks %}

{% block content %}

<style>
    :root {
        --primary-color: #667eea;
        --primary-hover: #5568d3;
        --success-color: #10b981;
        --danger-color: #ef4444;
        --warning-color: #f59e0b;
        --gray-50: #f9fafb;
        --gray-100: #f3f4f6;
        --gray-200: #e5e7eb;
        --gray-300: #d1d5db;
        --gray-600: #4b5563;
        --gray-700: #374151;
        --gray-900: #111827;
        --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
        --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
    }

    /* Back Button Styling */
    .back-button-container {
        padding: 1.5rem 0 1rem 0;
        margin-bottom: 1rem;
    }

    .back-btn-modern {
        padding: 0.625rem 1.25rem;
        font-size: 14px;
        font-weight: 500;
        border-radius: 8px;
        transition: all 0.2s ease;
        border: 2px solid var(--primary-color);
        color: var(--primary-color);
        background: white;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
    }

    .back-btn-modern:hover {
        background: var(--primary-color);
        color: white;
        transform: translateX(-3px);
        box-shadow: var(--shadow-md);
    }

    /* Page Header */
    .page-header {
        background: linear-gradient(135deg, var(--primary-color) 0%, #764ba2 100%);
        color: white;
        padding: 2rem;
        border-radius: 12px;
        margin-bottom: 2rem;
        box-shadow: var(--shadow-lg);
    }

    .page-header h2 {
        margin: 0;
        font-size: 1.75rem;
        font-weight: 600;
    }

    .page-header .houseboat-name {
        font-size: 1.1rem;
        opacity: 0.95;
        margin-top: 0.5rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    /* Form Card Styling */
    .form-card {
        background: white;
        border-radius: 12px;
        box-shadow: var(--shadow-md);
        margin-bottom: 2rem;
        overflow: hidden;
        border: 1px solid var(--gray-200);
    }

    .form-card-header {
        background: var(--gray-50);
        padding: 1.25rem 1.5rem;
        border-bottom: 2px solid var(--gray-200);
    }

    .form-card-header h5 {
        margin: 0;
        font-size: 1.125rem;
        font-weight: 600;
        color: var(--gray-900);
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .form-card-body {
        padding: 1.5rem;
    }

    /* Form Styling */
    .price-form-container .form-group {
        margin-bottom: 1rem;
    }

    .price-form-container .form-label {
        font-size: 0.813rem;
        font-weight: 600;
        margin-bottom: 0.375rem;
        color: var(--gray-700);
        display: block;
    }

    .price-form-container .form-control,
    .price-form-container .form-select {
        font-size: 0.875rem;
        padding: 0.5rem 0.75rem;
        border: 1.5px solid var(--gray-300);
        border-radius: 6px;
        transition: all 0.2s ease;
    }

    .price-form-container .form-control:focus,
    .price-form-container .form-select:focus {
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        outline: none;
    }

    /* Form Sections */
    .form-section {
        background: var(--gray-50);
        padding: 1rem;
        border-radius: 8px;
        margin-bottom: 1rem;
    }

    .form-section-title {
        font-size: 0.875rem;
        font-weight: 600;
        color: var(--gray-700);
        margin-bottom: 0.75rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    /* Button Styling */
    .btn-primary-custom {
        background: var(--primary-color);
        border: none;
        color: white;
        padding: 0.625rem 1.5rem;
        border-radius: 8px;
        font-weight: 500;
        transition: all 0.2s ease;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
    }

    .btn-primary-custom:hover {
        background: var(--primary-hover);
        transform: translateY(-1px);
        box-shadow: var(--shadow-md);
    }

    /* Table Container */
    .table-card {
        background: white;
        border-radius: 12px;
        box-shadow: var(--shadow-md);
        overflow: hidden;
        border: 1px solid var(--gray-200);
    }

    .table-card-header {
        background: var(--gray-50);
        padding: 1.25rem 1.5rem;
        border-bottom: 2px solid var(--gray-200);
    }

    .table-card-header h5 {
        margin: 0;
        font-size: 1.125rem;
        font-weight: 600;
        color: var(--gray-900);
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    /* Table Wrapper for Horizontal Scroll */
    .table-wrapper {
        overflow-x: auto;
        position: relative;
    }

    .table-wrapper::-webkit-scrollbar {
        height: 8px;
    }

    .table-wrapper::-webkit-scrollbar-track {
        background: var(--gray-100);
    }

    .table-wrapper::-webkit-scrollbar-thumb {
        background: var(--gray-300);
        border-radius: 4px;
    }

    .table-wrapper::-webkit-scrollbar-thumb:hover {
        background: var(--gray-600);
    }

    /* Table Styling */
    .rate-list-table {
        margin: 0;
        min-width: 1400px;
        font-size: 0.875rem;
    }

    .rate-list-table thead {
        background: var(--gray-100);
        position: sticky;
        top: 0;
        z-index: 10;
    }

    .rate-list-table th {
        font-weight: 600;
        font-size: 0.813rem;
        color: var(--gray-700);
        padding: 0.875rem 0.75rem;
        border-bottom: 2px solid var(--gray-300);
        white-space: nowrap;
        text-transform: uppercase;
        letter-spacing: 0.3px;
    }

    .rate-list-table tbody tr {
        border-bottom: 1px solid var(--gray-200);
        transition: background-color 0.15s ease;
    }

    .rate-list-table tbody tr:hover {
        background-color: var(--gray-50);
    }

    .rate-list-table td {
        padding: 0.875rem 0.75rem;
        vertical-align: middle;
        color: var(--gray-700);
    }

    /* Sticky First Column */
    .rate-list-table th:first-child,
    .rate-list-table td:first-child {
        position: sticky;
        left: 0;
        background: white;
        z-index: 5;
        box-shadow: 2px 0 4px rgba(0,0,0,0.05);
    }

    .rate-list-table thead th:first-child {
        background: var(--gray-100);
        z-index: 15;
    }

    .rate-list-table tbody tr:hover td:first-child {
        background: var(--gray-50);
    }

    /* Number Cells - Right Align */
    .rate-list-table td:nth-child(n+5) {
        text-align: right;
        font-family: 'Courier New', monospace;
        font-weight: 500;
    }

    /* Action Column */
    .action-cell {
        text-align: center !important;
        position: sticky;
        right: 0;
        background: white;
        z-index: 5;
        box-shadow: -2px 0 4px rgba(0,0,0,0.05);
    }

    .rate-list-table tbody tr:hover .action-cell {
        background: var(--gray-50);
    }

    .action-icons {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.375rem;
    }

    .btn-icon {
        padding: 0.375rem 0.5rem;
        border-radius: 6px;
        transition: all 0.2s ease;
        border: none;
        cursor: pointer;
    }

    .btn-edit {
        background: var(--gray-100);
        color: var(--gray-700);
    }

    .btn-edit:hover {
        background: var(--primary-color);
        color: white;
    }

    .btn-delete {
        background: var(--gray-100);
        color: var(--danger-color);
    }

    .btn-delete:hover {
        background: var(--danger-color);
        color: white;
    }

    /* Empty State */
    .empty-state {
        text-align: center;
        padding: 3rem 1rem;
        color: var(--gray-600);
    }

    .empty-state i {
        font-size: 3rem;
        color: var(--gray-300);
        margin-bottom: 1rem;
    }

    /* Responsive Design */
    @media (max-width: 768px) {
        .form-card-body {
            padding: 1rem;
        }

        .page-header {
            padding: 1.5rem;
        }

        .page-header h2 {
            font-size: 1.5rem;
        }

        .back-button-container {
            padding: 1rem 0 0.5rem 0;
        }
    }

    /* Alert Messages */
    .alert-custom {
        border-radius: 8px;
        padding: 1rem 1.25rem;
        margin-bottom: 1.5rem;
        border: none;
        box-shadow: var(--shadow-sm);
    }

    .alert-success {
        background: #d1fae5;
        color: #065f46;
    }

    .alert-danger {
        background: #fee2e2;
        color: #991b1b;
    }
</style>

<div class="container-fluid px-3 px-md-4">
    <div class="back-button-container">
        <a href="{% url 'houseboat_list' %}" class="back-btn-modern">
            <i class="fas fa-arrow-left"></i>
            <span>Back to Settings</span>
        </a>
    </div>

    <div class="page-header">
        <h2><i class="fas fa-rupee-sign"></i> Houseboat Pricing Management</h2>
        <div class="houseboat-name">
            <i class="fas fa-ship"></i>
            <span>{{ houseboat.name }}</span>
        </div>
    </div>

    <!--{% if messages %}-->
    <!--    {% for message in messages %}-->
    <!--        <div class="alert-custom alert-{{ message.tags }}">-->
    <!--            <i class="fas fa-{% if message.tags == 'success' %}check-circle{% else %}exclamation-circle{% endif %}"></i>-->
    <!--            {{ message }}-->
    <!--        </div>-->
    <!--    {% endfor %}-->
    <!--{% endif %}-->

    <div class="form-card">
        <div class="form-card-header">
            <h5>
                <i class="fas fa-{% if form.instance.pk %}edit{% else %}plus-circle{% endif %}"></i>
                {% if form.instance.pk %}Update Price Entry{% else %}Add New Price Entry{% endif %}
            </h5>
        </div>
        <div class="form-card-body">
            <form class="price-form-container" method="POST" action="{% if form.instance.pk %}{% url 'houseboat_price_update' houseboat.id form.instance.pk %}{% else %}{% url 'houseboat_price_list' houseboat.id %}{% endif %}">
                {% csrf_token %}
                
                {% if form.non_field_errors %}
                    <div class="alert-custom alert-danger mb-4">
                        <i class="fas fa-exclamation-triangle"></i>
                        <strong>Error:</strong>
                        {% for error in form.non_field_errors %}
                            {{ error }}
                        {% endfor %}
                    </div>
                {% endif %}
                <div class="form-section">
                    <div class="form-section-title"><i class="fas fa-calendar-alt"></i> Date Range & Configuration</div>
                    <div class="row g-3">
                        <div class="col-md-3">
                            <label class="form-label">From Date</label>
                            {{ form.from_date|add_class:"form-control"|attr:"type:date" }}
                            {% if form.from_date.errors %}
                                <div class="text-danger small mt-1">{{ form.from_date.errors.0 }}</div>
                            {% endif %}
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">To Date</label>
                            {{ form.to_date|add_class:"form-control"|attr:"type:date" }}
                            {% if form.to_date.errors %}
                                <div class="text-danger small mt-1">{{ form.to_date.errors.0 }}</div>
                            {% endif %}
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">Room Type</label>
                            {{ form.room_type|add_class:"form-select" }}
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">Meal Plan</label>
                            {{ form.meal_plan|add_class:"form-select" }}
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <div class="form-section-title"><i class="fas fa-bed"></i> Pricing Per Bed Configuration (₹)</div>
                    <div class="row g-3">
                        <div class="col-6 col-md-4 col-lg-2">
                            <label class="form-label">1 Bed</label>
                            {{ form.one_bed|add_class:"form-control text-end"|attr:"placeholder:0" }}
                        </div>
                        <div class="col-6 col-md-4 col-lg-2">
                            <label class="form-label">2 Beds</label>
                            {{ form.two_bed|add_class:"form-control text-end"|attr:"placeholder:0" }}
                        </div>
                        <div class="col-6 col-md-4 col-lg-2">
                            <label class="form-label">3 Beds</label>
                            {{ form.three_bed|add_class:"form-control text-end"|attr:"placeholder:0" }}
                        </div>
                        <div class="col-6 col-md-4 col-lg-2">
                            <label class="form-label">4 Beds</label>
                            {{ form.four_bed|add_class:"form-control text-end"|attr:"placeholder:0" }}
                        </div>
                        <div class="col-6 col-md-4 col-lg-2">
                            <label class="form-label">5 Beds</label>
                            {{ form.five_bed|add_class:"form-control text-end"|attr:"placeholder:0" }}
                        </div>
                        <div class="col-6 col-md-4 col-lg-2">
                            <label class="form-label">6 Beds</label>
                            {{ form.six_bed|add_class:"form-control text-end"|attr:"placeholder:0" }}
                        </div>
                        <div class="col-6 col-md-4 col-lg-2">
                            <label class="form-label">7 Beds</label>
                            {{ form.seven_bed|add_class:"form-control text-end"|attr:"placeholder:0" }}
                        </div>
                        <div class="col-6 col-md-4 col-lg-2">
                            <label class="form-label">8 Beds</label>
                            {{ form.eight_bed|add_class:"form-control text-end"|attr:"placeholder:0" }}
                        </div>
                        <div class="col-6 col-md-4 col-lg-2">
                            <label class="form-label">9 Beds</label>
                            {{ form.nine_bed|add_class:"form-control text-end"|attr:"placeholder:0" }}
                        </div>
                        <div class="col-6 col-md-4 col-lg-2">
                            <label class="form-label">10 Beds</label>
                            {{ form.ten_bed|add_class:"form-control text-end"|attr:"placeholder:0" }}
                        </div>
                        <div class="col-6 col-md-4 col-lg-2">
                            <label class="form-label">Extra Bed</label>
                            {{ form.extra_bed|add_class:"form-control text-end"|attr:"placeholder:0" }}
                        </div>
                    </div>
                </div>

                <div class="text-end mt-3">
                    <button type="submit" class="btn-primary-custom">
                        <i class="fas fa-{% if form.instance.pk %}save{% else %}plus{% endif %}"></i>
                        {% if form.instance.pk %}Update Price{% else %}Add Price{% endif %}
                    </button>
                </div>
            </form>
        </div>
    </div>

    <div class="table-card">
        <div class="table-card-header">
            <h5>
                <i class="fas fa-table"></i>
                Current Pricing Rates
                <small class="text-muted ms-2">({{ prices|length }} entries)</small>
            </h5>
        </div>
        <div class="table-wrapper">
            <table class="table table-hover mb-0 rate-list-table">
                <thead>
                    <tr>
                        <th>From Date</th>
                        <th>To Date</th>
                        <th>Room Type</th>
                        <th>Meal Plan</th>
                        <th>1 Bed</th>
                        <th>2 Bed</th>
                        <th>3 Bed</th>
                        <th>4 Bed</th>
                        <th>5 Bed</th>
                        <th>6 Bed</th>
                        <th>7 Bed</th>
                        <th>8 Bed</th>
                        <th>9 Bed</th>
                        <th>10 Bed</th>
                        <th>Extra</th>
                        <th class="action-cell">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for price in prices %}
                    <tr>
                        <td>{{ price.from_date|date:"d/m/Y" }}</td>
                        <td>{{ price.to_date|date:"d/m/Y" }}</td>
                        <td>{{ price.room_type.name }}</td>
                        <td>{{ price.meal_plan.name }}</td>
                        <td>₹{{ price.one_bed|floatformat:0 }}</td>
                        <td>₹{{ price.two_bed|floatformat:0 }}</td>
                        <td>₹{{ price.three_bed|floatformat:0 }}</td>
                        <td>₹{{ price.four_bed|floatformat:0 }}</td>
                        <td>₹{{ price.five_bed|floatformat:0 }}</td>
                        <td>₹{{ price.six_bed|floatformat:0 }}</td>
                        <td>₹{{ price.seven_bed|floatformat:0 }}</td>
                        <td>₹{{ price.eight_bed|floatformat:0 }}</td>
                        <td>₹{{ price.nine_bed|floatformat:0 }}</td>
                        <td>₹{{ price.ten_bed|floatformat:0 }}</td>
                        <td>₹{{ price.extra_bed|floatformat:0 }}</td>
                        <td class="action-cell">
                            <div class="action-icons">
                                <a href="{% url 'houseboat_price_update' houseboat.id price.id %}" 
                                   class="btn-icon btn-edit" 
                                   title="Edit">
                                    <i class="bi bi-pencil"></i>
                                </a>
                                <form action="{% url 'houseboat_price_delete' houseboat.id price.id %}" 
                                      method="post" 
                                      class="d-inline"
                                      onsubmit="return confirm('Are you sure you want to delete this price entry?');">
                                    {% csrf_token %}
                                    <button type="submit" class="btn-icon btn-delete" title="Delete">
                                        <i class="bi bi-trash"></i>
                                    </button>
                                </form>
                            </div>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="16">
                            <div class="empty-state">
                                <i class="fas fa-inbox"></i>
                                <p class="mb-0">No pricing entries found. Add your first price entry above.</p>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<script>
// Auto-dismiss alerts after 5 seconds
document.addEventListener('DOMContentLoaded', function() {
    const alerts = document.querySelectorAll('.alert-custom');
    alerts.forEach(alert => {
        // Do not auto-dismiss error alerts (optional preference)
        // If you want errors to stay until user closes them, check if classList contains 'alert-danger'
        setTimeout(() => {
            alert.style.transition = 'opacity 0.5s ease';
            alert.style.opacity = '0';
            setTimeout(() => alert.remove(), 500);
        }, 5000);
    });
});
</script>

{% endblock %}
